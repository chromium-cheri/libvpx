{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c5d1533f_f975aeaf",
        "filename": "vp9/encoder/vp9_firstpass.c",
        "patchSetId": 6
      },
      "lineNbr": 2973,
      "author": {
        "id": 1467232
      },
      "writtenOn": "2024-06-07T23:02:25Z",
      "side": 1,
      "message": "From get_gop_coding_frame_num it seems to return the number of show frames?",
      "range": {
        "startLine": 2972,
        "startChar": 28,
        "endLine": 2973,
        "endChar": 24
      },
      "revId": "b27f79b4e02e2004d4e7ccdbaf9a73aaa422922f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "977b3df1_69145f84",
        "filename": "vp9/encoder/vp9_firstpass.c",
        "patchSetId": 6
      },
      "lineNbr": 2973,
      "author": {
        "id": 1132564
      },
      "writtenOn": "2024-06-08T00:16:00Z",
      "side": 1,
      "message": "Yep, it\u0027s a bit confusing.\nYou can look at line 2955\nrc-\u003ebaseline_gf_interval \u003d gop_coding_frames - rc-\u003esource_alt_ref_pending\n\nMy understanding is that \"baseline_gf_interval\" is the actual show_frame_count\n\"source_alt_ref_pending\" is the indicator of using alt_ref or not for this GOP.\n\nSo from line 2955, gop_coding_frames means number of coding frame in GOP including show/no show frames.\n\nAlso if you check ext_rc_define_gf_group_structure() which is a simplified version of define_gf_group_structure()\nI modified it in a way that it generate the same gf_group as define_gf_group_structure().\n\nWe have\ngf_group-\u003egf_group_size \u003d gop_decision-\u003egop_coding_frames\ngf_group_size is the number of coding frames in this GOP.",
      "parentUuid": "c5d1533f_f975aeaf",
      "range": {
        "startLine": 2972,
        "startChar": 28,
        "endLine": 2973,
        "endChar": 24
      },
      "revId": "b27f79b4e02e2004d4e7ccdbaf9a73aaa422922f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "94b2e576_a2c9aa98",
        "filename": "vp9/encoder/vp9_firstpass.c",
        "patchSetId": 6
      },
      "lineNbr": 2973,
      "author": {
        "id": 1467232
      },
      "writtenOn": "2024-06-08T00:55:40Z",
      "side": 1,
      "message": "If believe line 2955 is trying to determine the \"actual\" max gf interval (show frames). There are multiple places that indicates the gop_coding_frames should be show frame number. For example line 2881:\n`rc-\u003econstrained_gf_group \u003d (gop_coding_frames \u003e\u003d rc-\u003eframes_to_key) ? 1 : 0;\n`\nand also following that line:\n```\nconst int f_frames \u003d\n        (rc-\u003eframes_to_key - gop_coding_frames \u003e\u003d gop_coding_frames - 1)\n            ? gop_coding_frames - 1\n            : VPXMAX(0, rc-\u003eframes_to_key - gop_coding_frames);\n    const int b_frames \u003d gop_coding_frames - 1;\n```\n\nIt could be the case that gop_decision-\u003egop_coding_frames is the number of coding frames. But it looks to me gop_coding_frames in this function should be the number of shown frames.",
      "parentUuid": "977b3df1_69145f84",
      "range": {
        "startLine": 2972,
        "startChar": 28,
        "endLine": 2973,
        "endChar": 24
      },
      "revId": "b27f79b4e02e2004d4e7ccdbaf9a73aaa422922f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d88652c0_5481f4f9",
        "filename": "vp9/encoder/vp9_firstpass.c",
        "patchSetId": 6
      },
      "lineNbr": 2973,
      "author": {
        "id": 1132564
      },
      "writtenOn": "2024-06-10T19:03:42Z",
      "side": 1,
      "message": "Here is my log of printing all the gop_coding_frames of each gf_group\nWe encode a video with --limit\u003d35 using libvpx baseline\n\ngop_index 0 gop_coding_frames 17\ngop_index 1 gop_coding_frames 9\ngop_index 2 gop_coding_frames 11\ngop_index 3 gop_coding_frames 1\n\nIt doesn\u0027t sum up to 35.\nIt sums up to 38 because each of the first 3 GOPs has an ARF.\n\nSometimes the code contradicts with itself. Here I think it seems like it\u0027s be assigned like \"show frame count\" but being used like \"coding frame count\".\n\nWe are trying to fix issue in an easy way because this part may not even be used by webmrc. We only call define_gf_group() to avoid needing to track down all the settings in it that might affect the coding performance. Also this fix will not affect the baseline.",
      "parentUuid": "94b2e576_a2c9aa98",
      "range": {
        "startLine": 2972,
        "startChar": 28,
        "endLine": 2973,
        "endChar": 24
      },
      "revId": "b27f79b4e02e2004d4e7ccdbaf9a73aaa422922f",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}