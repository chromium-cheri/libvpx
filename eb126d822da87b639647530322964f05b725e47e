{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "54f68b32_1c3d0d6d",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1001914
      },
      "writtenOn": "2023-10-11T19:58:19Z",
      "side": 1,
      "message": "This step happens before the coding mode rate-distortion optimization search. The associated xd-\u003emi[0] hasn\u0027t been decided at this point.\n\nThe do_rd_ml_partition_var_prouning can only remove the search of certain coding block partition types. It won\u0027t affect the mode info including ref_frame[0] and interp_filter selection.\n\nI am guessing that there might be some other subtle issues that can be hidden by changing this speed feature?",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3ab0a5c0_57b28e8a",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1171444
      },
      "writtenOn": "2023-10-11T20:38:50Z",
      "side": 1,
      "message": "Hmm, the same block was hit in `vp9_rd_pick_inter_mode_sb` where the `interp_filter` and `ref_frame[0]` were chosen before it hits here again.",
      "parentUuid": "54f68b32_1c3d0d6d",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d823138_5bea2291",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1001914
      },
      "writtenOn": "2023-10-11T21:05:59Z",
      "side": 1,
      "message": "Can you check if in this particular case, this speed feature somehow bypasses all the coding block partition and leaves an invalid coding mode decisions?",
      "parentUuid": "54f68b32_1c3d0d6d",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bf5d312e_ff2ad751",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1001914
      },
      "writtenOn": "2023-10-11T21:07:12Z",
      "side": 1,
      "message": "The encoder runs a recursive block partition search. The same position can be searched multiple times with different coding block sizes.",
      "parentUuid": "4d823138_5bea2291",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a793060a_f370ee84",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1171444
      },
      "writtenOn": "2023-10-11T21:23:46Z",
      "side": 1,
      "message": "I logged out the decision at end of `rd_pick_sb_modes` and that block was only hit once in that function.\n\nIt does go into `rd_pick_sb_modes` after the ML pruning, but the `interp_filter` and `ref_frame[0]` aren\u0027t changed. Maybe it gets early termination with an illegal mode decision. I\u0027ll give it another pass to see what exactly happens there. (it takes a while to run each time since it\u0027s encoding 1080p with debug build).",
      "parentUuid": "bf5d312e_ff2ad751",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d99ff8cd_67b0f4cd",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1001914
      },
      "writtenOn": "2023-10-11T21:30:56Z",
      "side": 1,
      "message": "Does the returned rate distortion cost look reasonable, or any of them hits INT_MAX or INT64_MAX?",
      "parentUuid": "a793060a_f370ee84",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "09951ef9_c6ad75cc",
        "filename": "vp9/encoder/vp9_encodeframe.c",
        "patchSetId": 3
      },
      "lineNbr": 4094,
      "author": {
        "id": 1171444
      },
      "writtenOn": "2023-10-12T00:30:22Z",
      "side": 1,
      "message": "The `best_rd` calculated from `vp9_calculate_rd_cost` here:\n\nhttps://chromium.googlesource.com/webm/libvpx/+/refs/heads/main/vp9/encoder/vp9_encodeframe.c#2043\n\nfor that block is INT64_MAX\n\nSo when it enters `vp9_rd_pick_inter_mode_sub8x8` every candidate mode is skipped...",
      "parentUuid": "d99ff8cd_67b0f4cd",
      "range": {
        "startLine": 4094,
        "startChar": 8,
        "endLine": 4094,
        "endChar": 31
      },
      "revId": "eb126d822da87b639647530322964f05b725e47e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}