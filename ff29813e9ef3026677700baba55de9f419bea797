{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0e828294_18c38b7f",
        "filename": "vpx_dsp/arm/fdct_partial_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 146,
      "author": {
        "id": 1000882
      },
      "writtenOn": "2022-10-06T16:57:58Z",
      "side": 1,
      "message": "You could have an A64 version of this loop that uses vaddw_high_s16(). Can you post the current disassembly for this function? I\u0027m curious to see how the compiler is behaving.",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 146,
        "endChar": 42
      },
      "revId": "ff29813e9ef3026677700baba55de9f419bea797",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3b82b12_8823dd69",
        "filename": "vpx_dsp/arm/fdct_partial_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 146,
      "author": {
        "id": 1537919
      },
      "writtenOn": "2022-10-07T06:47:21Z",
      "side": 1,
      "message": "Sure, here it is (optimized build, gcc 9.4.0):\n\n0000000000000210 \u003cvpx_fdct32x32_1_neon\u003e:\n 210:   937f7c44        sbfiz   x4, x2, #1, #32\n 214:   528003e3        mov     w3, #0x1f                       // #31\n 218:   ad400003        ldp     q3, q0, [x0]\n 21c:   8b040002        add     x2, x0, x4\n 220:   ad410402        ldp     q2, q1, [x0, #32]\n 224:   d503201f        nop\n 228:   71000463        subs    w3, w3, #0x1\n 22c:   ad401847        ldp     q7, q6, [x2]\n 230:   ad411045        ldp     q5, q4, [x2, #32]\n 234:   8b040042        add     x2, x2, x4\n 238:   4e678463        add     v3.8h, v3.8h, v7.8h\n 23c:   4e668400        add     v0.8h, v0.8h, v6.8h\n 240:   4e658442        add     v2.8h, v2.8h, v5.8h\n 244:   4e648421        add     v1.8h, v1.8h, v4.8h\n 248:   54ffff01        b.ne    228 \u003cvpx_fdct32x32_1_neon+0x18\u003e  // b.any\n 24c:   4e703863        saddlv  s3, v3.8h\n 250:   4e703800        saddlv  s0, v0.8h\n 254:   0ea38400        add     v0.2s, v0.2s, v3.2s\n 258:   1e260000        fmov    w0, s0\n 25c:   4e703840        saddlv  s0, v2.8h\n 260:   1e260002        fmov    w2, s0\n 264:   4e703820        saddlv  s0, v1.8h\n 268:   0b020000        add     w0, w0, w2\n 26c:   1e260002        fmov    w2, s0\n 270:   0b020000        add     w0, w0, w2\n 274:   13037c00        asr     w0, w0, #3\n 278:   29007c20        stp     w0, wzr, [x1]\n 27c:   d65f03c0        ret\n \n Can try with a newer compiler if needed.",
      "parentUuid": "0e828294_18c38b7f",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 146,
        "endChar": 42
      },
      "revId": "ff29813e9ef3026677700baba55de9f419bea797",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "832e56fe_695ed9c1",
        "filename": "vpx_dsp/arm/fdct_partial_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 146,
      "author": {
        "id": 1000882
      },
      "writtenOn": "2022-10-07T13:11:48Z",
      "side": 1,
      "message": "Thanks!",
      "parentUuid": "a3b82b12_8823dd69",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 146,
        "endChar": 42
      },
      "revId": "ff29813e9ef3026677700baba55de9f419bea797",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "71908536_34802d6f",
        "filename": "vpx_dsp/arm/fdct_partial_neon.c",
        "patchSetId": 1
      },
      "lineNbr": 146,
      "author": {
        "id": 1000882
      },
      "writtenOn": "2022-10-07T14:49:23Z",
      "side": 1,
      "message": "Could not understand how this code would work because it would outrange, then noticed you posted vpx_fdct32x32_1_neon(). \n\nHere is the highbd version:\n0000000000000714 \u003cvpx_highbd_fdct32x32_1_neon\u003e:\n 714:\t91008008 \tadd\tx8, x0, #0x20\n 718:\t937f7c49 \tsbfiz\tx9, x2, #1, #32\n 71c:\t6f00e401 \tmovi\tv1.2d, #0x0\n 720:\t5280040a \tmov\tw10, #0x20                  \t// #32\n 724:\t6f00e403 \tmovi\tv3.2d, #0x0\n 728:\t6f00e402 \tmovi\tv2.2d, #0x0\n 72c:\t6f00e400 \tmovi\tv0.2d, #0x0\n 730:\tad7f1504 \tldp\tq4, q5, [x8, #-32]\n 734:\tad401d06 \tldp\tq6, q7, [x8]\n 738:\t7100054a \tsubs\tw10, w10, #0x1\n 73c:\t8b090108 \tadd\tx8, x8, x9\n 740:\t0e641021 \tsaddw\tv1.4s, v1.4s, v4.4h\n 744:\t0e651063 \tsaddw\tv3.4s, v3.4s, v5.4h\n 748:\t0e661042 \tsaddw\tv2.4s, v2.4s, v6.4h\n 74c:\t0e671000 \tsaddw\tv0.4s, v0.4s, v7.4h\n 750:\t4e641021 \tsaddw2\tv1.4s, v1.4s, v4.8h\n 754:\t4e651063 \tsaddw2\tv3.4s, v3.4s, v5.8h\n 758:\t4e661042 \tsaddw2\tv2.4s, v2.4s, v6.8h\n 75c:\t4e671000 \tsaddw2\tv0.4s, v0.4s, v7.8h\n 760:\t54fffe81 \tb.ne\t730 \u003cvpx_highbd_fdct32x32_1_neon+0x1c\u003e  // b.any\n 764:\t4eb1b821 \taddv\ts1, v1.4s\n 768:\t4eb1b863 \taddv\ts3, v3.4s\n 76c:\t4eb1b842 \taddv\ts2, v2.4s\n 770:\t1e260028 \tfmov\tw8, s1\n 774:\t1e260069 \tfmov\tw9, s3\n 778:\t4eb1b800 \taddv\ts0, v0.4s\n 77c:\t0b080128 \tadd\tw8, w9, w8\n 780:\t1e260049 \tfmov\tw9, s2\n 784:\t1e26000a \tfmov\tw10, s0\n 788:\t0b090108 \tadd\tw8, w8, w9\n 78c:\t0b0a0108 \tadd\tw8, w8, w10\n 790:\t13037d08 \tasr\tw8, w8, #3\n 794:\t29007c28 \tstp\tw8, wzr, [x1]\n 798:\td65f03c0 \tret\n \n \n The compiler is using vaddw_high_s16(), so another version shouldn\u0027t be necessary.",
      "parentUuid": "832e56fe_695ed9c1",
      "range": {
        "startLine": 146,
        "startChar": 0,
        "endLine": 146,
        "endChar": 42
      },
      "revId": "ff29813e9ef3026677700baba55de9f419bea797",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}