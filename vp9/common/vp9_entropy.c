/*
 *  Copyright (c) 2010 The WebM project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree. An additional intellectual property rights grant can be found
 *  in the file PATENTS.  All contributing project authors may
 *  be found in the AUTHORS file in the root of the source tree.
 */


#include <stdio.h>

#include "vp9/common/vp9_entropy.h"
#include "string.h"
#include "vp9/common/vp9_blockd.h"
#include "vp9/common/vp9_onyxc_int.h"
#include "vp9/common/vp9_entropymode.h"
#include "vpx_mem/vpx_mem.h"
#include "vpx/vpx_integer.h"
#include "vp9/common/vp9_coefupdateprobs.h"

const int vp9_i8x8_block[4] = {0, 2, 8, 10};

DECLARE_ALIGNED(16, const uint8_t, vp9_norm[256]) = {
  0, 7, 6, 6, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4,
  3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
  2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
  2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};

// Unified coefficient band structure used by all block sizes
DECLARE_ALIGNED(16, const int, vp9_coef_bands[32]) = {
  0, 1, 2, 3, 3, 3, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 5,
  5, 5, 5, 5, 5, 5, 5, 5,
  5, 5, 5, 5, 5, 5, 5, 5
};
DECLARE_ALIGNED(16, const int, vp9_coef_bands4x4[16]) = {
  0, 1, 2, 3, 3, 3, 4, 4,
  4, 4, 5, 5, 5, 5, 5, 5
};

DECLARE_ALIGNED(16, const uint8_t, vp9_pt_energy_class[MAX_ENTROPY_TOKENS]) = {
  0, 1, 2, 3, 3, 4, 4, 5, 5, 5, 5, 5
};

DECLARE_ALIGNED(16, const int, vp9_default_zig_zag1d_4x4[16]) = {
  0,  1,  4,  8,
  5,  2,  3,  6,
  9, 12, 13, 10,
  7, 11, 14, 15,
};

DECLARE_ALIGNED(16, const int, vp9_col_scan_4x4[16]) = {
  0, 4,  8, 12,
  1, 5,  9, 13,
  2, 6, 10, 14,
  3, 7, 11, 15
};

DECLARE_ALIGNED(16, const int, vp9_row_scan_4x4[16]) = {
  0,   1,  2,  3,
  4,   5,  6,  7,
  8,   9, 10, 11,
  12, 13, 14, 15
};

DECLARE_ALIGNED(64, const int, vp9_default_zig_zag1d_8x8[64]) = {
  0,  1,  8, 16,  9,  2,  3, 10, 17, 24, 32, 25, 18, 11,  4,  5,
  12, 19, 26, 33, 40, 48, 41, 34, 27, 20, 13,  6,  7, 14, 21, 28,
  35, 42, 49, 56, 57, 50, 43, 36, 29, 22, 15, 23, 30, 37, 44, 51,
  58, 59, 52, 45, 38, 31, 39, 46, 53, 60, 61, 54, 47, 55, 62, 63,
};

DECLARE_ALIGNED(16, const int, vp9_default_zig_zag1d_16x16[256]) = {
  0,   1,  16,  32,  17,   2,   3,  18,
  33,  48,  64,  49,  34,  19,   4,   5,
  20,  35,  50,  65,  80,  96,  81,  66,
  51,  36,  21,   6,   7,  22,  37,  52,
  67,  82,  97, 112, 128, 113,  98,  83,
  68,  53,  38,  23,   8,   9,  24,  39,
  54,  69,  84,  99, 114, 129, 144, 160,
  145, 130, 115, 100,  85,  70,  55,  40,
  25,  10,  11,  26,  41,  56,  71,  86,
  101, 116, 131, 146, 161, 176, 192, 177,
  162, 147, 132, 117, 102,  87,  72,  57,
  42,  27,  12,  13,  28,  43,  58, 73,
  88, 103, 118, 133, 148, 163, 178, 193,
  208, 224, 209, 194, 179, 164, 149, 134,
  119, 104,  89,  74,  59,  44,  29,  14,
  15,  30, 45,  60,  75,  90, 105, 120,
  135, 150, 165, 180, 195, 210, 225, 240,
  241, 226, 211, 196, 181, 166, 151, 136,
  121, 106,  91,  76,  61,  46,  31,  47,
  62,  77, 92, 107, 122, 137, 152, 167,
  182, 197, 212, 227, 242, 243, 228, 213,
  198, 183, 168, 153, 138, 123, 108, 93,
  78,  63,  79,  94, 109, 124, 139, 154,
  169, 184, 199, 214, 229, 244, 245, 230,
  215, 200, 185, 170, 155, 140, 125, 110,
  95, 111, 126, 141, 156, 171, 186, 201,
  216, 231, 246, 247, 232, 217, 202, 187,
  172, 157, 142, 127, 143, 158, 173, 188,
  203, 218, 233, 248, 249, 234, 219, 204,
  189, 174, 159, 175, 190, 205, 220, 235,
  250, 251, 236, 221, 206, 191, 207, 222,
  237, 252, 253, 238, 223, 239, 254, 255,
};

DECLARE_ALIGNED(16, const int, vp9_default_zig_zag1d_32x32[1024]) = {
    0,    1,   32,   64,   33,    2,    3,   34,   65,   96,  128,   97,   66,   35,    4,    5,   36,   67,   98,  129,  160,  192,  161,  130,   99,   68,   37,    6,    7,   38,   69,  100,
  131,  162,  193,  224,  256,  225,  194,  163,  132,  101,   70,   39,    8,    9,   40,   71,  102,  133,  164,  195,  226,  257,  288,  320,  289,  258,  227,  196,  165,  134,  103,   72,
   41,   10,   11,   42,   73,  104,  135,  166,  197,  228,  259,  290,  321,  352,  384,  353,  322,  291,  260,  229,  198,  167,  136,  105,   74,   43,   12,   13,   44,   75,  106,  137,
  168,  199,  230,  261,  292,  323,  354,  385,  416,  448,  417,  386,  355,  324,  293,  262,  231,  200,  169,  138,  107,   76,   45,   14,   15,   46,   77,  108,  139,  170,  201,  232,
  263,  294,  325,  356,  387,  418,  449,  480,  512,  481,  450,  419,  388,  357,  326,  295,  264,  233,  202,  171,  140,  109,   78,   47,   16,   17,   48,   79,  110,  141,  172,  203,
  234,  265,  296,  327,  358,  389,  420,  451,  482,  513,  544,  576,  545,  514,  483,  452,  421,  390,  359,  328,  297,  266,  235,  204,  173,  142,  111,   80,   49,   18,   19,   50,
   81,  112,  143,  174,  205,  236,  267,  298,  329,  360,  391,  422,  453,  484,  515,  546,  577,  608,  640,  609,  578,  547,  516,  485,  454,  423,  392,  361,  330,  299,  268,  237,
  206,  175,  144,  113,   82,   51,   20,   21,   52,   83,  114,  145,  176,  207,  238,  269,  300,  331,  362,  393,  424,  455,  486,  517,  548,  579,  610,  641,  672,  704,  673,  642,
  611,  580,  549,  518,  487,  456,  425,  394,  363,  332,  301,  270,  239,  208,  177,  146,  115,   84,   53,   22,   23,   54,   85,  116,  147,  178,  209,  240,  271,  302,  333,  364,
  395,  426,  457,  488,  519,  550,  581,  612,  643,  674,  705,  736,  768,  737,  706,  675,  644,  613,  582,  551,  520,  489,  458,  427,  396,  365,  334,  303,  272,  241,  210,  179,
  148,  117,   86,   55,   24,   25,   56,   87,  118,  149,  180,  211,  242,  273,  304,  335,  366,  397,  428,  459,  490,  521,  552,  583,  614,  645,  676,  707,  738,  769,  800,  832,
  801,  770,  739,  708,  677,  646,  615,  584,  553,  522,  491,  460,  429,  398,  367,  336,  305,  274,  243,  212,  181,  150,  119,   88,   57,   26,   27,   58,   89,  120,  151,  182,
  213,  244,  275,  306,  337,  368,  399,  430,  461,  492,  523,  554,  585,  616,  647,  678,  709,  740,  771,  802,  833,  864,  896,  865,  834,  803,  772,  741,  710,  679,  648,  617,
  586,  555,  524,  493,  462,  431,  400,  369,  338,  307,  276,  245,  214,  183,  152,  121,   90,   59,   28,   29,   60,   91,  122,  153,  184,  215,  246,  277,  308,  339,  370,  401,
  432,  463,  494,  525,  556,  587,  618,  649,  680,  711,  742,  773,  804,  835,  866,  897,  928,  960,  929,  898,  867,  836,  805,  774,  743,  712,  681,  650,  619,  588,  557,  526,
  495,  464,  433,  402,  371,  340,  309,  278,  247,  216,  185,  154,  123,   92,   61,   30,   31,   62,   93,  124,  155,  186,  217,  248,  279,  310,  341,  372,  403,  434,  465,  496,
  527,  558,  589,  620,  651,  682,  713,  744,  775,  806,  837,  868,  899,  930,  961,  992,  993,  962,  931,  900,  869,  838,  807,  776,  745,  714,  683,  652,  621,  590,  559,  528,
  497,  466,  435,  404,  373,  342,  311,  280,  249,  218,  187,  156,  125,   94,   63,   95,  126,  157,  188,  219,  250,  281,  312,  343,  374,  405,  436,  467,  498,  529,  560,  591,
  622,  653,  684,  715,  746,  777,  808,  839,  870,  901,  932,  963,  994,  995,  964,  933,  902,  871,  840,  809,  778,  747,  716,  685,  654,  623,  592,  561,  530,  499,  468,  437,
  406,  375,  344,  313,  282,  251,  220,  189,  158,  127,  159,  190,  221,  252,  283,  314,  345,  376,  407,  438,  469,  500,  531,  562,  593,  624,  655,  686,  717,  748,  779,  810,
  841,  872,  903,  934,  965,  996,  997,  966,  935,  904,  873,  842,  811,  780,  749,  718,  687,  656,  625,  594,  563,  532,  501,  470,  439,  408,  377,  346,  315,  284,  253,  222,
  191,  223,  254,  285,  316,  347,  378,  409,  440,  471,  502,  533,  564,  595,  626,  657,  688,  719,  750,  781,  812,  843,  874,  905,  936,  967,  998,  999,  968,  937,  906,  875,
  844,  813,  782,  751,  720,  689,  658,  627,  596,  565,  534,  503,  472,  441,  410,  379,  348,  317,  286,  255,  287,  318,  349,  380,  411,  442,  473,  504,  535,  566,  597,  628,
  659,  690,  721,  752,  783,  814,  845,  876,  907,  938,  969, 1000, 1001,  970,  939,  908,  877,  846,  815,  784,  753,  722,  691,  660,  629,  598,  567,  536,  505,  474,  443,  412,
  381,  350,  319,  351,  382,  413,  444,  475,  506,  537,  568,  599,  630,  661,  692,  723,  754,  785,  816,  847,  878,  909,  940,  971, 1002, 1003,  972,  941,  910,  879,  848,  817,
  786,  755,  724,  693,  662,  631,  600,  569,  538,  507,  476,  445,  414,  383,  415,  446,  477,  508,  539,  570,  601,  632,  663,  694,  725,  756,  787,  818,  849,  880,  911,  942,
  973, 1004, 1005,  974,  943,  912,  881,  850,  819,  788,  757,  726,  695,  664,  633,  602,  571,  540,  509,  478,  447,  479,  510,  541,  572,  603,  634,  665,  696,  727,  758,  789,
  820,  851,  882,  913,  944,  975, 1006, 1007,  976,  945,  914,  883,  852,  821,  790,  759,  728,  697,  666,  635,  604,  573,  542,  511,  543,  574,  605,  636,  667,  698,  729,  760,
  791,  822,  853,  884,  915,  946,  977, 1008, 1009,  978,  947,  916,  885,  854,  823,  792,  761,  730,  699,  668,  637,  606,  575,  607,  638,  669,  700,  731,  762,  793,  824,  855,
  886,  917,  948,  979, 1010, 1011,  980,  949,  918,  887,  856,  825,  794,  763,  732,  701,  670,  639,  671,  702,  733,  764,  795,  826,  857,  888,  919,  950,  981, 1012, 1013,  982,
  951,  920,  889,  858,  827,  796,  765,  734,  703,  735,  766,  797,  828,  859,  890,  921,  952,  983, 1014, 1015,  984,  953,  922,  891,  860,  829,  798,  767,  799,  830,  861,  892,
  923,  954,  985, 1016, 1017,  986,  955,  924,  893,  862,  831,  863,  894,  925,  956,  987, 1018, 1019,  988,  957,  926,  895,  927,  958,  989, 1020, 1021,  990,  959,  991, 1022, 1023,
};

/* Array indices are identical to previously-existing CONTEXT_NODE indices */

const vp9_tree_index vp9_coef_tree[ 22] =     /* corresponding _CONTEXT_NODEs */
{
  -DCT_EOB_TOKEN, 2,                             /* 0 = EOB */
  -ZERO_TOKEN, 4,                               /* 1 = ZERO */
  -ONE_TOKEN, 6,                               /* 2 = ONE */
  8, 12,                                      /* 3 = LOW_VAL */
  -TWO_TOKEN, 10,                            /* 4 = TWO */
  -THREE_TOKEN, -FOUR_TOKEN,                /* 5 = THREE */
  14, 16,                                    /* 6 = HIGH_LOW */
  -DCT_VAL_CATEGORY1, -DCT_VAL_CATEGORY2,   /* 7 = CAT_ONE */
  18, 20,                                   /* 8 = CAT_THREEFOUR */
  -DCT_VAL_CATEGORY3, -DCT_VAL_CATEGORY4,  /* 9 = CAT_THREE */
  -DCT_VAL_CATEGORY5, -DCT_VAL_CATEGORY6   /* 10 = CAT_FIVE */
};

struct vp9_token_struct vp9_coef_encodings[MAX_ENTROPY_TOKENS];

/* Trees for extra bits.  Probabilities are constant and
   do not depend on previously encoded bits */

static const vp9_prob Pcat1[] = { 159};
static const vp9_prob Pcat2[] = { 165, 145};
static const vp9_prob Pcat3[] = { 173, 148, 140};
static const vp9_prob Pcat4[] = { 176, 155, 140, 135};
static const vp9_prob Pcat5[] = { 180, 157, 141, 134, 130};
static const vp9_prob Pcat6[] = {
  254, 254, 254, 252, 249, 243, 230, 196, 177, 153, 140, 133, 130, 129
};

#if CONFIG_CODE_NONZEROCOUNT
const vp9_tree_index vp9_nzc4x4_tree[2 * NZC4X4_NODES] = {
  -NZC_0, 2,
  4, 6,
  -NZC_1, -NZC_2,
  -NZC_3TO4, 8,
  -NZC_5TO8, -NZC_9TO16,
};
struct vp9_token_struct vp9_nzc4x4_encodings[NZC4X4_TOKENS];

const vp9_tree_index vp9_nzc8x8_tree[2 * NZC8X8_NODES] = {
  -NZC_0, 2,
  4, 6,
  -NZC_1, -NZC_2,
  8, 10,
  -NZC_3TO4, -NZC_5TO8,
  -NZC_9TO16, 12,
  -NZC_17TO32, -NZC_33TO64,
};
struct vp9_token_struct vp9_nzc8x8_encodings[NZC8X8_TOKENS];

const vp9_tree_index vp9_nzc16x16_tree[2 * NZC16X16_NODES] = {
  -NZC_0, 2,
  4, 6,
  -NZC_1, -NZC_2,
  8, 10,
  -NZC_3TO4, -NZC_5TO8,
  12, 14,
  -NZC_9TO16, -NZC_17TO32,
  -NZC_33TO64, 16,
  -NZC_65TO128, -NZC_129TO256,
};
struct vp9_token_struct vp9_nzc16x16_encodings[NZC16X16_TOKENS];

const vp9_tree_index vp9_nzc32x32_tree[2 * NZC32X32_NODES] = {
  -NZC_0, 2,
  4, 6,
  -NZC_1, -NZC_2,
  8, 10,
  -NZC_3TO4, -NZC_5TO8,
  12, 14,
  -NZC_9TO16, -NZC_17TO32,
  16, 18,
  -NZC_33TO64, -NZC_65TO128,
  -NZC_129TO256, 20,
  -NZC_257TO512, -NZC_513TO1024,
};
struct vp9_token_struct vp9_nzc32x32_encodings[NZC32X32_TOKENS];

const int vp9_extranzcbits[NZC32X32_TOKENS] = {
  0, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
};

const int vp9_basenzcvalue[NZC32X32_TOKENS] = {
  0, 1, 2, 3, 5, 9, 17, 33, 65, 129, 257, 513
};

#endif  // CONFIG_CODE_NONZEROCOUNT

#if CONFIG_MODELCOEFPROB

const vp9_prob vp9_modelcoefprobs_geo[COEFPROB_MODELS][ENTROPY_NODES - 1] = {
  // Geometric distribution
  {0,   0,   0,   0,   0,   0,   0,   0,   0,   0,},  // do not use
  {1,   1,   3,  86, 128,   6,  86,  23,  88,  30,},
  {2,   2,   6,  86, 129,  12,  87,  44,  91,  57,},
  {3,   3,   9,  86, 129,  17,  87,  63,  93,  80,},
  {4,   4,  12,  87, 129,  23,  88,  80,  96, 101,},
  {5,   5,  15,  87, 129,  28,  89,  96,  99, 119,},
  {6,   6,  18,  87, 130,  34,  89, 111, 102, 136,},
  {7,   7,  20,  88, 130,  39,  90, 124, 105, 150,},
  {8,   8,  23,  88, 130,  44,  91, 136, 108, 163,},
  {9,   9,  26,  88, 130,  49,  91, 147, 110, 174,},
  {10,  10,  29,  89, 131,  54,  92, 157, 113, 184,},
  {11,  11,  31,  89, 131,  59,  93, 166, 116, 193,},
  {12,  12,  34,  89, 131,  64,  94, 175, 119, 201,},
  {13,  13,  37,  90, 131,  69,  94, 182, 122, 207,},
  {14,  14,  40,  90, 132,  73,  95, 189, 125, 213,},
  {15,  15,  42,  91, 132,  78,  96, 196, 128, 219,},
  {16,  16,  45,  91, 132,  82,  97, 201, 131, 223,},
  {17,  17,  48,  91, 132,  86,  97, 206, 134, 227,},
  {18,  18,  50,  92, 133,  90,  98, 211, 137, 231,},
  {19,  19,  53,  92, 133,  95,  99, 215, 140, 234,},
  {20,  20,  55,  92, 133,  99,  99, 219, 142, 237,},
  {21,  21,  58,  93, 133, 102, 100, 223, 145, 239,},
  {22,  22,  60,  93, 134, 106, 101, 226, 148, 241,},
  {23,  23,  63,  93, 134, 110, 102, 229, 151, 243,},
  {24,  24,  65,  94, 134, 114, 103, 232, 154, 245,},
  {25,  25,  68,  94, 135, 117, 103, 234, 157, 246,},
  {26,  26,  70,  95, 135, 121, 104, 236, 159, 248,},
  {27,  27,  73,  95, 135, 124, 105, 238, 162, 249,},
  {28,  28,  75,  95, 135, 128, 106, 240, 165, 250,},
  {29,  29,  77,  96, 136, 131, 106, 242, 167, 250,},
  {30,  30,  80,  96, 136, 134, 107, 243, 170, 251,},
  {31,  31,  82,  97, 136, 138, 108, 244, 172, 252,},
  {32,  32,  84,  97, 136, 141, 109, 245, 175, 252,},
  {33,  33,  86,  97, 137, 144, 110, 247, 177, 253,},
  {34,  34,  89,  98, 137, 147, 110, 248, 180, 253,},
  {35,  35,  91,  98, 137, 150, 111, 248, 182, 254,},
  {36,  36,  93,  98, 138, 152, 112, 249, 184, 254,},
  {37,  37,  95,  99, 138, 155, 113, 250, 187, 254,},
  {38,  38,  98,  99, 138, 158, 114, 250, 189, 254,},
  {39,  39, 100, 100, 139, 161, 114, 251, 191, 255,},
  {40,  40, 102, 100, 139, 163, 115, 252, 193, 255,},
  {41,  41, 104, 101, 139, 166, 116, 252, 195, 255,},
  {42,  42, 106, 101, 139, 168, 117, 252, 197, 255,},
  {43,  43, 108, 101, 140, 171, 118, 253, 199, 255,},
  {44,  44, 110, 102, 140, 173, 119, 253, 201, 255,},
  {45,  45, 112, 102, 140, 175, 119, 253, 203, 255,},
  {46,  46, 114, 103, 141, 178, 120, 254, 205, 255,},
  {47,  47, 116, 103, 141, 180, 121, 254, 207, 255,},
  {48,  48, 118, 103, 141, 182, 122, 254, 208, 255,},
  {49,  49, 120, 104, 141, 184, 123, 254, 210, 255,},
  {50,  50, 122, 104, 142, 186, 124, 255, 212, 255,},
  {51,  51, 124, 105, 142, 188, 125, 255, 213, 255,},
  {52,  52, 126, 105, 142, 190, 125, 255, 215, 255,},
  {53,  53, 128, 106, 143, 192, 126, 255, 217, 255,},
  {54,  54, 130, 106, 143, 194, 127, 255, 218, 255,},
  {55,  55, 132, 106, 143, 196, 128, 255, 219, 255,},
  {56,  56, 134, 107, 144, 197, 129, 255, 221, 255,},
  {57,  57, 135, 107, 144, 199, 130, 255, 222, 255,},
  {58,  58, 137, 108, 144, 201, 131, 255, 223, 255,},
  {59,  59, 139, 108, 145, 202, 132, 255, 225, 255,},
  {60,  60, 141, 109, 145, 204, 132, 255, 226, 255,},
  {61,  61, 142, 109, 145, 206, 133, 255, 227, 255,},
  {62,  62, 144, 110, 146, 207, 134, 255, 228, 255,},
  {63,  63, 146, 110, 146, 209, 135, 255, 229, 255,},
  {64,  64, 148, 111, 146, 210, 136, 255, 230, 255,},
  {65,  65, 149, 111, 147, 211, 137, 255, 231, 255,},
  {66,  66, 151, 112, 147, 213, 138, 255, 232, 255,},
  {67,  67, 153, 112, 147, 214, 139, 255, 233, 255,},
  {68,  68, 154, 112, 148, 216, 140, 255, 234, 255,},
  {69,  69, 156, 113, 148, 217, 141, 255, 235, 255,},
  {70,  70, 157, 113, 148, 218, 141, 255, 236, 255,},
  {71,  71, 159, 114, 149, 219, 142, 255, 237, 255,},
  {72,  72, 161, 114, 149, 220, 143, 255, 238, 255,},
  {73,  73, 162, 115, 149, 222, 144, 255, 238, 255,},
  {74,  74, 164, 115, 150, 223, 145, 255, 239, 255,},
  {75,  75, 165, 116, 150, 224, 146, 255, 240, 255,},
  {76,  76, 167, 116, 150, 225, 147, 255, 241, 255,},
  {77,  77, 168, 117, 151, 226, 148, 255, 241, 255,},
  {78,  78, 170, 117, 151, 227, 149, 255, 242, 255,},
  {79,  79, 171, 118, 151, 228, 150, 255, 242, 255,},
  {80,  80, 172, 118, 152, 229, 151, 255, 243, 255,},
  {81,  81, 174, 119, 152, 230, 152, 255, 244, 255,},
  {82,  82, 175, 119, 152, 230, 153, 255, 244, 255,},
  {83,  83, 177, 120, 153, 231, 153, 255, 245, 255,},
  {84,  84, 178, 120, 153, 232, 154, 255, 245, 255,},
  {85,  85, 179, 121, 153, 233, 155, 255, 246, 255,},
  {86,  86, 181, 121, 154, 234, 156, 255, 246, 255,},
  {87,  87, 182, 122, 154, 235, 157, 255, 247, 255,},
  {88,  88, 183, 122, 154, 235, 158, 255, 247, 255,},
  {89,  89, 184, 123, 155, 236, 159, 255, 247, 255,},
  {90,  90, 186, 124, 155, 237, 160, 255, 248, 255,},
  {91,  91, 187, 124, 156, 237, 161, 255, 248, 255,},
  {92,  92, 188, 125, 156, 238, 162, 255, 249, 255,},
  {93,  93, 189, 125, 156, 239, 163, 255, 249, 255,},
  {94,  94, 191, 126, 157, 239, 164, 255, 249, 255,},
  {95,  95, 192, 126, 157, 240, 165, 255, 250, 255,},
  {96,  96, 193, 127, 157, 241, 166, 255, 250, 255,},
  {97,  97, 194, 127, 158, 241, 166, 255, 250, 255,},
  {98,  98, 195, 128, 158, 242, 167, 255, 251, 255,},
  {99,  99, 197, 128, 159, 242, 168, 255, 251, 255,},
  {100, 100, 198, 129, 159, 243, 169, 255, 251, 255,},
  {101, 101, 199, 130, 159, 243, 170, 255, 251, 255,},
  {102, 102, 200, 130, 160, 244, 171, 255, 252, 255,},
  {103, 103, 201, 131, 160, 244, 172, 255, 252, 255,},
  {104, 104, 202, 131, 160, 245, 173, 255, 252, 255,},
  {105, 105, 203, 132, 161, 245, 174, 255, 252, 255,},
  {106, 106, 204, 132, 161, 245, 175, 255, 252, 255,},
  {107, 107, 205, 133, 162, 246, 176, 255, 253, 255,},
  {108, 108, 206, 134, 162, 246, 177, 255, 253, 255,},
  {109, 109, 207, 134, 162, 247, 178, 255, 253, 255,},
  {110, 110, 208, 135, 163, 247, 178, 255, 253, 255,},
  {111, 111, 209, 135, 163, 247, 179, 255, 253, 255,},
  {112, 112, 210, 136, 164, 248, 180, 255, 253, 255,},
  {113, 113, 211, 137, 164, 248, 181, 255, 254, 255,},
  {114, 114, 212, 137, 164, 248, 182, 255, 254, 255,},
  {115, 115, 213, 138, 165, 249, 183, 255, 254, 255,},
  {116, 116, 214, 138, 165, 249, 184, 255, 254, 255,},
  {117, 117, 215, 139, 166, 249, 185, 255, 254, 255,},
  {118, 118, 215, 140, 166, 250, 186, 255, 254, 255,},
  {119, 119, 216, 140, 167, 250, 187, 255, 254, 255,},
  {120, 120, 217, 141, 167, 250, 188, 255, 254, 255,},
  {121, 121, 218, 141, 167, 250, 188, 255, 254, 255,},
  {122, 122, 219, 142, 168, 251, 189, 255, 255, 255,},
  {123, 123, 220, 143, 168, 251, 190, 255, 255, 255,},
  {124, 124, 221, 143, 169, 251, 191, 255, 255, 255,},
  {125, 125, 221, 144, 169, 251, 192, 255, 255, 255,},
  {126, 126, 222, 145, 170, 252, 193, 255, 255, 255,},
  {127, 127, 223, 145, 170, 252, 194, 255, 255, 255,},
  {128, 128, 224, 146, 170, 252, 195, 255, 255, 255,},
  {129, 129, 225, 147, 171, 252, 196, 255, 255, 255,},
  {130, 130, 226, 148, 172, 252, 197, 255, 255, 255,},
  {131, 131, 227, 149, 172, 253, 198, 255, 255, 255,},
  {132, 132, 227, 149, 173, 253, 199, 255, 255, 255,},
  {133, 133, 228, 150, 173, 253, 200, 255, 255, 255,},
  {134, 134, 229, 151, 174, 253, 201, 255, 255, 255,},
  {135, 135, 229, 151, 174, 253, 201, 255, 255, 255,},
  {136, 136, 230, 152, 175, 253, 202, 255, 255, 255,},
  {137, 137, 231, 153, 175, 253, 203, 255, 255, 255,},
  {138, 138, 231, 153, 175, 254, 204, 255, 255, 255,},
  {139, 139, 232, 154, 176, 254, 205, 255, 255, 255,},
  {140, 140, 232, 155, 176, 254, 206, 255, 255, 255,},
  {141, 141, 233, 155, 177, 254, 206, 255, 255, 255,},
  {142, 142, 234, 156, 177, 254, 207, 255, 255, 255,},
  {143, 143, 234, 157, 178, 254, 208, 255, 255, 255,},
  {144, 144, 235, 157, 178, 254, 209, 255, 255, 255,},
  {145, 145, 235, 158, 179, 254, 210, 255, 255, 255,},
  {146, 146, 236, 159, 179, 254, 210, 255, 255, 255,},
  {147, 147, 236, 160, 180, 255, 211, 255, 255, 255,},
  {148, 148, 237, 160, 180, 255, 212, 255, 255, 255,},
  {149, 149, 238, 161, 181, 255, 213, 255, 255, 255,},
  {150, 150, 238, 162, 181, 255, 214, 255, 255, 255,},
  {151, 151, 239, 162, 182, 255, 214, 255, 255, 255,},
  {152, 152, 239, 163, 182, 255, 215, 255, 255, 255,},
  {153, 153, 240, 164, 183, 255, 216, 255, 255, 255,},
  {154, 154, 240, 165, 183, 255, 217, 255, 255, 255,},
  {155, 155, 240, 165, 184, 255, 217, 255, 255, 255,},
  {156, 156, 241, 166, 184, 255, 218, 255, 255, 255,},
  {157, 157, 241, 167, 185, 255, 219, 255, 255, 255,},
  {158, 158, 242, 168, 185, 255, 219, 255, 255, 255,},
  {159, 159, 242, 168, 186, 255, 220, 255, 255, 255,},
  {160, 160, 243, 169, 186, 255, 221, 255, 255, 255,},
  {161, 161, 243, 170, 187, 255, 222, 255, 255, 255,},
  {162, 162, 243, 171, 187, 255, 222, 255, 255, 255,},
  {163, 163, 244, 171, 188, 255, 223, 255, 255, 255,},
  {164, 164, 244, 172, 189, 255, 224, 255, 255, 255,},
  {165, 165, 245, 173, 189, 255, 224, 255, 255, 255,},
  {166, 166, 245, 174, 190, 255, 225, 255, 255, 255,},
  {167, 167, 245, 175, 190, 255, 226, 255, 255, 255,},
  {168, 168, 246, 175, 191, 255, 226, 255, 255, 255,},
  {169, 169, 246, 176, 191, 255, 227, 255, 255, 255,},
  {170, 170, 246, 177, 192, 255, 228, 255, 255, 255,},
  {171, 171, 247, 178, 192, 255, 228, 255, 255, 255,},
  {172, 172, 247, 179, 193, 255, 229, 255, 255, 255,},
  {173, 173, 247, 179, 194, 255, 230, 255, 255, 255,},
  {174, 174, 248, 180, 194, 255, 230, 255, 255, 255,},
  {175, 175, 248, 181, 195, 255, 231, 255, 255, 255,},
  {176, 176, 248, 182, 195, 255, 231, 255, 255, 255,},
  {177, 177, 249, 183, 196, 255, 232, 255, 255, 255,},
  {178, 178, 249, 183, 196, 255, 233, 255, 255, 255,},
  {179, 179, 249, 184, 197, 255, 233, 255, 255, 255,},
  {180, 180, 249, 185, 198, 255, 234, 255, 255, 255,},
  {181, 181, 250, 186, 198, 255, 234, 255, 255, 255,},
  {182, 182, 250, 187, 199, 255, 235, 255, 255, 255,},
  {183, 183, 250, 188, 199, 255, 235, 255, 255, 255,},
  {184, 184, 250, 188, 200, 255, 236, 255, 255, 255,},
  {185, 185, 251, 189, 201, 255, 237, 255, 255, 255,},
  {186, 186, 251, 190, 201, 255, 237, 255, 255, 255,},
  {187, 187, 251, 191, 202, 255, 238, 255, 255, 255,},
  {188, 188, 251, 192, 202, 255, 238, 255, 255, 255,},
  {189, 189, 251, 193, 203, 255, 239, 255, 255, 255,},
  {190, 190, 252, 194, 204, 255, 239, 255, 255, 255,},
  {191, 191, 252, 194, 204, 255, 240, 255, 255, 255,},
  {192, 192, 252, 195, 205, 255, 240, 255, 255, 255,},
  {193, 193, 252, 196, 206, 255, 241, 255, 255, 255,},
  {194, 194, 252, 197, 206, 255, 241, 255, 255, 255,},
  {195, 195, 253, 198, 207, 255, 242, 255, 255, 255,},
  {196, 196, 253, 199, 208, 255, 242, 255, 255, 255,},
  {197, 197, 253, 200, 208, 255, 243, 255, 255, 255,},
  {198, 198, 253, 201, 209, 255, 243, 255, 255, 255,},
  {199, 199, 253, 201, 210, 255, 243, 255, 255, 255,},
  {200, 200, 253, 202, 210, 255, 244, 255, 255, 255,},
  {201, 201, 253, 203, 211, 255, 244, 255, 255, 255,},
  {202, 202, 254, 204, 212, 255, 245, 255, 255, 255,},
  {203, 203, 254, 205, 212, 255, 245, 255, 255, 255,},
  {204, 204, 254, 206, 213, 255, 246, 255, 255, 255,},
  {205, 205, 254, 207, 214, 255, 246, 255, 255, 255,},
  {206, 206, 254, 208, 214, 255, 246, 255, 255, 255,},
  {207, 207, 254, 209, 215, 255, 247, 255, 255, 255,},
  {208, 208, 254, 210, 216, 255, 247, 255, 255, 255,},
  {209, 209, 254, 210, 216, 255, 247, 255, 255, 255,},
  {210, 210, 255, 211, 217, 255, 248, 255, 255, 255,},
  {211, 211, 255, 212, 218, 255, 248, 255, 255, 255,},
  {212, 212, 255, 213, 219, 255, 249, 255, 255, 255,},
  {213, 213, 255, 214, 219, 255, 249, 255, 255, 255,},
  {214, 214, 255, 215, 220, 255, 249, 255, 255, 255,},
  {215, 215, 255, 216, 221, 255, 249, 255, 255, 255,},
  {216, 216, 255, 217, 222, 255, 250, 255, 255, 255,},
  {217, 217, 255, 218, 222, 255, 250, 255, 255, 255,},
  {218, 218, 255, 219, 223, 255, 250, 255, 255, 255,},
  {219, 219, 255, 220, 224, 255, 251, 255, 255, 255,},
  {220, 220, 255, 221, 225, 255, 251, 255, 255, 255,},
  {221, 221, 255, 222, 225, 255, 251, 255, 255, 255,},
  {222, 222, 255, 223, 226, 255, 252, 255, 255, 255,},
  {223, 223, 255, 224, 227, 255, 252, 255, 255, 255,},
  {224, 224, 255, 225, 228, 255, 252, 255, 255, 255,},
  {225, 225, 255, 226, 228, 255, 252, 255, 255, 255,},
  {226, 226, 255, 226, 229, 255, 253, 255, 255, 255,},
  {227, 227, 255, 227, 230, 255, 253, 255, 255, 255,},
  {228, 228, 255, 228, 231, 255, 253, 255, 255, 255,},
  {229, 229, 255, 229, 232, 255, 253, 255, 255, 255,},
  {230, 230, 255, 230, 232, 255, 253, 255, 255, 255,},
  {231, 231, 255, 231, 233, 255, 254, 255, 255, 255,},
  {232, 232, 255, 232, 234, 255, 254, 255, 255, 255,},
  {233, 233, 255, 233, 235, 255, 254, 255, 255, 255,},
  {234, 234, 255, 234, 236, 255, 254, 255, 255, 255,},
  {235, 235, 255, 235, 237, 255, 254, 255, 255, 255,},
  {236, 236, 255, 236, 238, 255, 254, 255, 255, 255,},
  {237, 237, 255, 237, 238, 255, 255, 255, 255, 255,},
  {238, 238, 255, 238, 239, 255, 255, 255, 255, 255,},
  {239, 239, 255, 239, 240, 255, 255, 255, 255, 255,},
  {240, 240, 255, 240, 241, 255, 255, 255, 255, 255,},
  {241, 241, 255, 241, 242, 255, 255, 255, 255, 255,},
  {242, 242, 255, 242, 243, 255, 255, 255, 255, 255,},
  {243, 243, 255, 243, 244, 255, 255, 255, 255, 255,},
  {244, 244, 255, 244, 245, 255, 255, 255, 255, 255,},
  {245, 245, 255, 245, 245, 255, 255, 255, 255, 255,},
  {246, 246, 255, 246, 246, 255, 255, 255, 255, 255,},
  {247, 247, 255, 247, 247, 255, 255, 255, 255, 255,},
  {248, 248, 255, 248, 248, 255, 255, 255, 255, 255,},
  {249, 249, 255, 249, 249, 255, 255, 255, 255, 255,},
  {250, 250, 255, 250, 250, 255, 255, 255, 255, 255,},
  {251, 251, 255, 251, 251, 255, 255, 255, 255, 255,},
  {252, 252, 255, 252, 252, 255, 255, 255, 255, 255,},
  {253, 253, 255, 253, 253, 255, 255, 255, 255, 255,},
  {254, 254, 255, 254, 254, 255, 255, 255, 255, 255,},
  {255, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
};

const vp9_prob vp9_modelcoefprobs_gg875[COEFPROB_MODELS][ENTROPY_NODES - 1] = {
  // Probs generated with a Generalized Gaussian (with shape parameter 0.875)
  // source model with varying quantizer step size for a uniform quantizer
  {0,   0,   0,   0,   0,   0,   0,   0,   0,   0,},  // do not use
  {1,   2,   6,  86, 129,  11,  87,  42,  92,  52,},
  {2,   4,  12,  87, 129,  22,  89,  75,  97,  91,},
  {3,   6,  17,  88, 130,  32,  90, 102, 102, 121,},
  {4,   8,  22,  89, 131,  41,  91, 125, 107, 145,},
  {5,  10,  28,  90, 131,  50,  93, 144, 112, 164,},
  {6,  12,  33,  90, 132,  59,  94, 160, 117, 180,},
  {7,  14,  38,  91, 132,  67,  95, 173, 122, 193,},
  {8,  15,  42,  92, 133,  75,  97, 185, 126, 204,},
  {9,  17,  47,  92, 133,  82,  98, 195, 131, 212,},
  {10,  19,  52,  93, 134,  89,  99, 203, 135, 220,},
  {11,  21,  56,  94, 134,  96, 101, 211, 140, 226,},
  {12,  23,  60,  95, 135, 102, 102, 217, 144, 231,},
  {13,  25,  65,  95, 135, 109, 103, 222, 148, 235,},
  {14,  26,  69,  96, 136, 115, 105, 227, 153, 238,},
  {15,  28,  73,  97, 136, 120, 106, 231, 157, 241,},
  {16,  30,  77,  97, 137, 126, 107, 234, 161, 244,},
  {17,  32,  81,  98, 138, 131, 108, 237, 164, 246,},
  {18,  34,  85,  99, 138, 136, 110, 240, 168, 247,},
  {19,  35,  89, 100, 139, 141, 111, 242, 172, 249,},
  {20,  37,  92, 100, 139, 145, 112, 244, 175, 250,},
  {21,  39,  96, 101, 140, 150, 113, 246, 179, 251,},
  {22,  41,  99, 102, 140, 154, 115, 247, 182, 252,},
  {23,  42, 103, 102, 141, 158, 116, 248, 185, 252,},
  {24,  44, 106, 103, 141, 162, 117, 249, 188, 253,},
  {25,  46, 110, 104, 142, 166, 118, 250, 191, 253,},
  {26,  48, 113, 104, 142, 170, 120, 251, 194, 254,},
  {27,  49, 116, 105, 143, 173, 121, 252, 197, 254,},
  {28,  51, 119, 106, 143, 176, 122, 252, 200, 254,},
  {29,  53, 122, 107, 144, 180, 123, 253, 202, 255,},
  {30,  54, 125, 107, 144, 183, 125, 253, 205, 255,},
  {31,  56, 128, 108, 145, 186, 126, 254, 207, 255,},
  {32,  58, 131, 109, 145, 189, 127, 254, 209, 255,},
  {33,  59, 134, 109, 146, 191, 128, 254, 212, 255,},
  {34,  61, 137, 110, 146, 194, 130, 254, 214, 255,},
  {35,  62, 139, 111, 147, 196, 131, 255, 216, 255,},
  {36,  64, 142, 112, 147, 199, 132, 255, 218, 255,},
  {37,  66, 145, 112, 148, 201, 134, 255, 220, 255,},
  {38,  67, 147, 113, 148, 203, 135, 255, 221, 255,},
  {39,  69, 150, 114, 149, 206, 136, 255, 223, 255,},
  {40,  70, 152, 114, 149, 208, 137, 255, 225, 255,},
  {41,  72, 155, 115, 150, 210, 138, 255, 226, 255,},
  {42,  74, 157, 116, 150, 212, 140, 255, 228, 255,},
  {43,  75, 159, 117, 151, 213, 141, 255, 229, 255,},
  {44,  77, 161, 117, 151, 215, 142, 255, 230, 255,},
  {45,  78, 164, 118, 152, 217, 143, 255, 232, 255,},
  {46,  80, 166, 119, 152, 219, 145, 255, 233, 255,},
  {47,  81, 168, 120, 153, 220, 146, 255, 234, 255,},
  {48,  83, 170, 120, 153, 222, 147, 255, 235, 255,},
  {49,  84, 172, 121, 154, 223, 148, 255, 236, 255,},
  {50,  86, 174, 122, 154, 225, 150, 255, 237, 255,},
  {51,  87, 176, 123, 155, 226, 151, 255, 238, 255,},
  {52,  89, 178, 123, 155, 227, 152, 255, 239, 255,},
  {53,  90, 180, 124, 156, 228, 153, 255, 240, 255,},
  {54,  92, 182, 125, 156, 230, 154, 255, 241, 255,},
  {55,  93, 183, 126, 157, 231, 156, 255, 242, 255,},
  {56,  95, 185, 126, 157, 232, 157, 255, 242, 255,},
  {57,  96, 187, 127, 158, 233, 158, 255, 243, 255,},
  {58,  98, 189, 128, 158, 234, 159, 255, 244, 255,},
  {59,  99, 190, 129, 159, 235, 160, 255, 244, 255,},
  {60, 101, 192, 129, 159, 236, 162, 255, 245, 255,},
  {61, 102, 193, 130, 160, 237, 163, 255, 246, 255,},
  {62, 104, 195, 131, 160, 238, 164, 255, 246, 255,},
  {63, 105, 197, 132, 161, 238, 165, 255, 247, 255,},
  {64, 106, 198, 132, 162, 239, 166, 255, 247, 255,},
  {65, 108, 199, 133, 162, 240, 167, 255, 248, 255,},
  {66, 109, 201, 134, 163, 241, 169, 255, 248, 255,},
  {67, 111, 202, 135, 163, 241, 170, 255, 249, 255,},
  {68, 112, 204, 135, 164, 242, 171, 255, 249, 255,},
  {69, 113, 205, 136, 164, 243, 172, 255, 249, 255,},
  {70, 115, 206, 137, 165, 243, 173, 255, 250, 255,},
  {71, 116, 208, 138, 165, 244, 174, 255, 250, 255,},
  {72, 117, 209, 138, 166, 244, 175, 255, 250, 255,},
  {73, 119, 210, 139, 166, 245, 177, 255, 251, 255,},
  {74, 120, 211, 140, 167, 245, 178, 255, 251, 255,},
  {75, 121, 212, 141, 167, 246, 179, 255, 251, 255,},
  {76, 123, 214, 142, 168, 246, 180, 255, 252, 255,},
  {77, 124, 215, 142, 168, 247, 181, 255, 252, 255,},
  {78, 125, 216, 143, 169, 247, 182, 255, 252, 255,},
  {79, 127, 217, 144, 170, 248, 183, 255, 252, 255,},
  {80, 128, 218, 145, 170, 248, 184, 255, 253, 255,},
  {81, 129, 219, 146, 171, 248, 185, 255, 253, 255,},
  {82, 131, 220, 146, 171, 249, 186, 255, 253, 255,},
  {83, 132, 221, 147, 172, 249, 187, 255, 253, 255,},
  {84, 133, 222, 148, 172, 249, 188, 255, 253, 255,},
  {85, 134, 223, 149, 173, 250, 189, 255, 253, 255,},
  {86, 136, 224, 149, 173, 250, 190, 255, 254, 255,},
  {87, 137, 225, 150, 174, 250, 191, 255, 254, 255,},
  {88, 138, 226, 151, 174, 251, 192, 255, 254, 255,},
  {89, 139, 226, 152, 175, 251, 193, 255, 254, 255,},
  {90, 141, 227, 153, 175, 251, 194, 255, 254, 255,},
  {91, 142, 228, 153, 176, 251, 195, 255, 254, 255,},
  {92, 143, 229, 154, 177, 252, 196, 255, 254, 255,},
  {93, 144, 230, 155, 177, 252, 197, 255, 254, 255,},
  {94, 146, 230, 156, 178, 252, 198, 255, 255, 255,},
  {95, 147, 231, 157, 178, 252, 199, 255, 255, 255,},
  {96, 148, 232, 157, 179, 252, 200, 255, 255, 255,},
  {97, 149, 233, 158, 179, 253, 201, 255, 255, 255,},
  {98, 150, 233, 159, 180, 253, 202, 255, 255, 255,},
  {99, 152, 234, 160, 180, 253, 203, 255, 255, 255,},
  {100, 153, 235, 161, 181, 253, 204, 255, 255, 255,},
  {101, 154, 235, 161, 182, 253, 205, 255, 255, 255,},
  {102, 155, 236, 162, 182, 253, 206, 255, 255, 255,},
  {103, 156, 236, 163, 183, 254, 207, 255, 255, 255,},
  {104, 157, 237, 164, 183, 254, 207, 255, 255, 255,},
  {105, 159, 238, 165, 184, 254, 208, 255, 255, 255,},
  {106, 160, 238, 166, 184, 254, 209, 255, 255, 255,},
  {107, 161, 239, 166, 185, 254, 210, 255, 255, 255,},
  {108, 162, 239, 167, 185, 254, 211, 255, 255, 255,},
  {109, 163, 240, 168, 186, 254, 212, 255, 255, 255,},
  {110, 164, 240, 169, 187, 254, 212, 255, 255, 255,},
  {111, 165, 241, 170, 187, 254, 213, 255, 255, 255,},
  {112, 166, 241, 170, 188, 255, 214, 255, 255, 255,},
  {113, 167, 242, 171, 188, 255, 215, 255, 255, 255,},
  {114, 169, 242, 172, 189, 255, 216, 255, 255, 255,},
  {115, 170, 243, 173, 189, 255, 216, 255, 255, 255,},
  {116, 171, 243, 174, 190, 255, 217, 255, 255, 255,},
  {117, 172, 244, 174, 190, 255, 218, 255, 255, 255,},
  {118, 173, 244, 175, 191, 255, 219, 255, 255, 255,},
  {119, 174, 244, 176, 192, 255, 219, 255, 255, 255,},
  {120, 175, 245, 177, 192, 255, 220, 255, 255, 255,},
  {121, 176, 245, 178, 193, 255, 221, 255, 255, 255,},
  {122, 177, 245, 178, 193, 255, 222, 255, 255, 255,},
  {123, 178, 246, 179, 194, 255, 222, 255, 255, 255,},
  {124, 179, 246, 180, 194, 255, 223, 255, 255, 255,},
  {125, 180, 247, 181, 195, 255, 224, 255, 255, 255,},
  {126, 181, 247, 182, 196, 255, 224, 255, 255, 255,},
  {127, 182, 247, 182, 196, 255, 225, 255, 255, 255,},
  {128, 183, 247, 183, 197, 255, 226, 255, 255, 255,},
  {129, 184, 248, 184, 197, 255, 226, 255, 255, 255,},
  {130, 185, 248, 185, 198, 255, 227, 255, 255, 255,},
  {131, 186, 248, 186, 198, 255, 228, 255, 255, 255,},
  {132, 187, 249, 186, 199, 255, 228, 255, 255, 255,},
  {133, 188, 249, 187, 200, 255, 229, 255, 255, 255,},
  {134, 189, 249, 188, 200, 255, 230, 255, 255, 255,},
  {135, 190, 249, 189, 201, 255, 230, 255, 255, 255,},
  {136, 191, 250, 190, 201, 255, 231, 255, 255, 255,},
  {137, 192, 250, 190, 202, 255, 231, 255, 255, 255,},
  {138, 193, 250, 191, 202, 255, 232, 255, 255, 255,},
  {139, 194, 250, 192, 203, 255, 232, 255, 255, 255,},
  {140, 195, 251, 193, 204, 255, 233, 255, 255, 255,},
  {141, 195, 251, 194, 204, 255, 234, 255, 255, 255,},
  {142, 196, 251, 194, 205, 255, 234, 255, 255, 255,},
  {143, 197, 251, 195, 205, 255, 235, 255, 255, 255,},
  {144, 198, 251, 196, 206, 255, 235, 255, 255, 255,},
  {145, 199, 252, 197, 206, 255, 236, 255, 255, 255,},
  {146, 200, 252, 197, 207, 255, 236, 255, 255, 255,},
  {147, 201, 252, 198, 208, 255, 237, 255, 255, 255,},
  {148, 202, 252, 199, 208, 255, 237, 255, 255, 255,},
  {149, 203, 252, 200, 209, 255, 238, 255, 255, 255,},
  {150, 203, 252, 201, 209, 255, 238, 255, 255, 255,},
  {151, 204, 253, 201, 210, 255, 239, 255, 255, 255,},
  {152, 205, 253, 202, 210, 255, 239, 255, 255, 255,},
  {153, 206, 253, 203, 211, 255, 239, 255, 255, 255,},
  {154, 207, 253, 204, 212, 255, 240, 255, 255, 255,},
  {155, 208, 253, 204, 212, 255, 240, 255, 255, 255,},
  {156, 209, 253, 205, 213, 255, 241, 255, 255, 255,},
  {157, 209, 253, 206, 213, 255, 241, 255, 255, 255,},
  {158, 210, 254, 207, 214, 255, 242, 255, 255, 255,},
  {159, 211, 254, 207, 214, 255, 242, 255, 255, 255,},
  {160, 212, 254, 208, 215, 255, 242, 255, 255, 255,},
  {161, 213, 254, 209, 215, 255, 243, 255, 255, 255,},
  {162, 213, 254, 210, 216, 255, 243, 255, 255, 255,},
  {163, 214, 254, 210, 217, 255, 244, 255, 255, 255,},
  {164, 215, 254, 211, 217, 255, 244, 255, 255, 255,},
  {165, 216, 254, 212, 218, 255, 244, 255, 255, 255,},
  {166, 216, 254, 212, 218, 255, 245, 255, 255, 255,},
  {167, 217, 254, 213, 219, 255, 245, 255, 255, 255,},
  {168, 218, 254, 214, 219, 255, 245, 255, 255, 255,},
  {169, 219, 255, 215, 220, 255, 246, 255, 255, 255,},
  {170, 219, 255, 215, 221, 255, 246, 255, 255, 255,},
  {171, 220, 255, 216, 221, 255, 246, 255, 255, 255,},
  {172, 221, 255, 217, 222, 255, 247, 255, 255, 255,},
  {173, 222, 255, 217, 222, 255, 247, 255, 255, 255,},
  {174, 222, 255, 218, 223, 255, 247, 255, 255, 255,},
  {175, 223, 255, 219, 223, 255, 248, 255, 255, 255,},
  {176, 224, 255, 220, 224, 255, 248, 255, 255, 255,},
  {177, 224, 255, 220, 224, 255, 248, 255, 255, 255,},
  {178, 225, 255, 221, 225, 255, 248, 255, 255, 255,},
  {179, 226, 255, 222, 225, 255, 249, 255, 255, 255,},
  {180, 226, 255, 222, 226, 255, 249, 255, 255, 255,},
  {181, 227, 255, 223, 227, 255, 249, 255, 255, 255,},
  {182, 228, 255, 224, 227, 255, 249, 255, 255, 255,},
  {183, 228, 255, 224, 228, 255, 250, 255, 255, 255,},
  {184, 229, 255, 225, 228, 255, 250, 255, 255, 255,},
  {185, 230, 255, 226, 229, 255, 250, 255, 255, 255,},
  {186, 230, 255, 226, 229, 255, 250, 255, 255, 255,},
  {187, 231, 255, 227, 230, 255, 251, 255, 255, 255,},
  {188, 232, 255, 228, 230, 255, 251, 255, 255, 255,},
  {189, 232, 255, 228, 231, 255, 251, 255, 255, 255,},
  {190, 233, 255, 229, 231, 255, 251, 255, 255, 255,},
  {191, 233, 255, 229, 232, 255, 251, 255, 255, 255,},
  {192, 234, 255, 230, 232, 255, 252, 255, 255, 255,},
  {193, 234, 255, 231, 233, 255, 252, 255, 255, 255,},
  {194, 235, 255, 231, 233, 255, 252, 255, 255, 255,},
  {195, 236, 255, 232, 234, 255, 252, 255, 255, 255,},
  {196, 236, 255, 232, 234, 255, 252, 255, 255, 255,},
  {197, 237, 255, 233, 235, 255, 252, 255, 255, 255,},
  {198, 237, 255, 234, 235, 255, 253, 255, 255, 255,},
  {199, 238, 255, 234, 236, 255, 253, 255, 255, 255,},
  {200, 238, 255, 235, 236, 255, 253, 255, 255, 255,},
  {201, 239, 255, 235, 237, 255, 253, 255, 255, 255,},
  {202, 239, 255, 236, 237, 255, 253, 255, 255, 255,},
  {203, 240, 255, 237, 238, 255, 253, 255, 255, 255,},
  {204, 240, 255, 237, 238, 255, 254, 255, 255, 255,},
  {205, 241, 255, 238, 239, 255, 254, 255, 255, 255,},
  {206, 241, 255, 238, 239, 255, 254, 255, 255, 255,},
  {207, 242, 255, 239, 240, 255, 254, 255, 255, 255,},
  {208, 242, 255, 239, 240, 255, 254, 255, 255, 255,},
  {209, 243, 255, 240, 241, 255, 254, 255, 255, 255,},
  {210, 243, 255, 240, 241, 255, 254, 255, 255, 255,},
  {211, 244, 255, 241, 242, 255, 254, 255, 255, 255,},
  {212, 244, 255, 241, 242, 255, 254, 255, 255, 255,},
  {213, 245, 255, 242, 243, 255, 255, 255, 255, 255,},
  {214, 245, 255, 242, 243, 255, 255, 255, 255, 255,},
  {215, 246, 255, 243, 244, 255, 255, 255, 255, 255,},
  {216, 246, 255, 243, 244, 255, 255, 255, 255, 255,},
  {217, 246, 255, 244, 244, 255, 255, 255, 255, 255,},
  {218, 247, 255, 244, 245, 255, 255, 255, 255, 255,},
  {219, 247, 255, 245, 245, 255, 255, 255, 255, 255,},
  {220, 248, 255, 245, 246, 255, 255, 255, 255, 255,},
  {221, 248, 255, 246, 246, 255, 255, 255, 255, 255,},
  {222, 248, 255, 246, 247, 255, 255, 255, 255, 255,},
  {223, 249, 255, 247, 247, 255, 255, 255, 255, 255,},
  {224, 249, 255, 247, 247, 255, 255, 255, 255, 255,},
  {225, 250, 255, 247, 248, 255, 255, 255, 255, 255,},
  {226, 250, 255, 248, 248, 255, 255, 255, 255, 255,},
  {227, 250, 255, 248, 249, 255, 255, 255, 255, 255,},
  {228, 251, 255, 249, 249, 255, 255, 255, 255, 255,},
  {229, 251, 255, 249, 249, 255, 255, 255, 255, 255,},
  {230, 251, 255, 249, 250, 255, 255, 255, 255, 255,},
  {231, 251, 255, 250, 250, 255, 255, 255, 255, 255,},
  {232, 252, 255, 250, 250, 255, 255, 255, 255, 255,},
  {233, 252, 255, 251, 251, 255, 255, 255, 255, 255,},
  {234, 252, 255, 251, 251, 255, 255, 255, 255, 255,},
  {235, 253, 255, 251, 251, 255, 255, 255, 255, 255,},
  {236, 253, 255, 252, 252, 255, 255, 255, 255, 255,},
  {237, 253, 255, 252, 252, 255, 255, 255, 255, 255,},
  {238, 253, 255, 252, 252, 255, 255, 255, 255, 255,},
  {239, 254, 255, 253, 253, 255, 255, 255, 255, 255,},
  {240, 254, 255, 253, 253, 255, 255, 255, 255, 255,},
  {241, 254, 255, 253, 253, 255, 255, 255, 255, 255,},
  {242, 254, 255, 253, 254, 255, 255, 255, 255, 255,},
  {243, 254, 255, 254, 254, 255, 255, 255, 255, 255,},
  {244, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
  {245, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
  {246, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
  {247, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {248, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {249, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {250, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {251, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {252, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {253, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {254, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {255, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
};

const vp9_prob vp9_modelcoefprobs_gg75[COEFPROB_MODELS][ENTROPY_NODES - 1] = {
  // Probs generated with a Generalized Gaussian (with shape parameter 0.75)
  // source model with varying quantizer step size for a uniform quantizer
  {0,   0,   0,   0,   0,   0,   0,   0,   0,   0,},  // do not use
  {1,   2,   6,  87, 129,  11,  88,  39,  93,  47,},
  {2,   4,  11,  88, 130,  21,  89,  68,  98,  79,},
  {3,   6,  16,  89, 131,  30,  91,  92, 103, 105,},
  {4,   8,  21,  90, 131,  38,  92, 112, 107, 126,},
  {5,  10,  26,  90, 132,  46,  94, 129, 111, 143,},
  {6,  11,  31,  91, 133,  54,  95, 143, 115, 157,},
  {7,  13,  35,  92, 133,  61,  96, 156, 119, 170,},
  {8,  15,  40,  93, 134,  68,  97, 167, 123, 180,},
  {9,  17,  44,  94, 134,  74,  98, 177, 126, 189,},
  {10,  19,  48,  94, 135,  80, 100, 185, 130, 197,},
  {11,  20,  52,  95, 135,  86, 101, 192, 133, 204,},
  {12,  22,  56,  96, 136,  92, 102, 199, 137, 210,},
  {13,  24,  60,  96, 136,  97, 103, 205, 140, 215,},
  {14,  26,  64,  97, 137, 103, 104, 210, 143, 219,},
  {15,  27,  68,  98, 137, 108, 105, 215, 146, 223,},
  {16,  29,  71,  98, 138, 112, 106, 219, 149, 227,},
  {17,  31,  75,  99, 138, 117, 107, 223, 152, 230,},
  {18,  32,  78, 100, 139, 121, 108, 226, 155, 233,},
  {19,  34,  82, 100, 139, 126, 109, 229, 158, 235,},
  {20,  36,  85, 101, 140, 130, 110, 231, 161, 238,},
  {21,  37,  88, 102, 140, 134, 111, 234, 164, 239,},
  {22,  39,  91, 102, 141, 138, 112, 236, 167, 241,},
  {23,  40,  94, 103, 141, 141, 113, 238, 169, 243,},
  {24,  42,  97, 104, 142, 145, 114, 240, 172, 244,},
  {25,  44, 100, 104, 142, 149, 115, 241, 174, 245,},
  {26,  45, 103, 105, 143, 152, 116, 243, 177, 246,},
  {27,  47, 106, 105, 143, 155, 117, 244, 179, 247,},
  {28,  48, 109, 106, 143, 158, 118, 245, 182, 248,},
  {29,  50, 112, 107, 144, 161, 119, 246, 184, 249,},
  {30,  52, 115, 107, 144, 164, 120, 247, 186, 250,},
  {31,  53, 117, 108, 145, 167, 121, 248, 188, 250,},
  {32,  55, 120, 109, 145, 170, 122, 249, 190, 251,},
  {33,  56, 122, 109, 146, 173, 123, 249, 192, 252,},
  {34,  58, 125, 110, 146, 175, 124, 250, 194, 252,},
  {35,  59, 127, 110, 147, 178, 125, 251, 196, 252,},
  {36,  61, 130, 111, 147, 180, 126, 251, 198, 253,},
  {37,  62, 132, 112, 147, 183, 127, 251, 200, 253,},
  {38,  64, 135, 112, 148, 185, 128, 252, 202, 253,},
  {39,  65, 137, 113, 148, 187, 129, 252, 204, 254,},
  {40,  67, 139, 114, 149, 189, 130, 253, 205, 254,},
  {41,  68, 141, 114, 149, 191, 131, 253, 207, 254,},
  {42,  70, 144, 115, 150, 193, 132, 253, 209, 254,},
  {43,  71, 146, 115, 150, 195, 133, 254, 210, 254,},
  {44,  72, 148, 116, 151, 197, 134, 254, 212, 255,},
  {45,  74, 150, 117, 151, 199, 135, 254, 213, 255,},
  {46,  75, 152, 117, 151, 201, 136, 254, 215, 255,},
  {47,  77, 154, 118, 152, 202, 137, 254, 216, 255,},
  {48,  78, 156, 119, 152, 204, 138, 254, 217, 255,},
  {49,  80, 158, 119, 153, 206, 139, 255, 219, 255,},
  {50,  81, 160, 120, 153, 207, 140, 255, 220, 255,},
  {51,  82, 162, 120, 154, 209, 141, 255, 221, 255,},
  {52,  84, 164, 121, 154, 210, 142, 255, 222, 255,},
  {53,  85, 165, 122, 155, 212, 143, 255, 224, 255,},
  {54,  87, 167, 122, 155, 213, 144, 255, 225, 255,},
  {55,  88, 169, 123, 155, 215, 145, 255, 226, 255,},
  {56,  89, 171, 124, 156, 216, 146, 255, 227, 255,},
  {57,  91, 172, 124, 156, 217, 146, 255, 228, 255,},
  {58,  92, 174, 125, 157, 218, 147, 255, 229, 255,},
  {59,  93, 176, 126, 157, 220, 148, 255, 230, 255,},
  {60,  95, 177, 126, 158, 221, 149, 255, 231, 255,},
  {61,  96, 179, 127, 158, 222, 150, 255, 232, 255,},
  {62,  97, 180, 127, 159, 223, 151, 255, 232, 255,},
  {63,  99, 182, 128, 159, 224, 152, 255, 233, 255,},
  {64, 100, 183, 129, 159, 225, 153, 255, 234, 255,},
  {65, 101, 185, 129, 160, 226, 154, 255, 235, 255,},
  {66, 103, 186, 130, 160, 227, 155, 255, 236, 255,},
  {67, 104, 188, 131, 161, 228, 156, 255, 236, 255,},
  {68, 105, 189, 131, 161, 229, 157, 255, 237, 255,},
  {69, 106, 190, 132, 162, 230, 158, 255, 238, 255,},
  {70, 108, 192, 133, 162, 231, 159, 255, 238, 255,},
  {71, 109, 193, 133, 162, 231, 159, 255, 239, 255,},
  {72, 110, 194, 134, 163, 232, 160, 255, 240, 255,},
  {73, 111, 196, 134, 163, 233, 161, 255, 240, 255,},
  {74, 113, 197, 135, 164, 234, 162, 255, 241, 255,},
  {75, 114, 198, 136, 164, 235, 163, 255, 241, 255,},
  {76, 115, 199, 136, 165, 235, 164, 255, 242, 255,},
  {77, 116, 200, 137, 165, 236, 165, 255, 243, 255,},
  {78, 118, 202, 138, 166, 237, 166, 255, 243, 255,},
  {79, 119, 203, 138, 166, 237, 167, 255, 244, 255,},
  {80, 120, 204, 139, 167, 238, 168, 255, 244, 255,},
  {81, 121, 205, 140, 167, 239, 168, 255, 244, 255,},
  {82, 123, 206, 140, 167, 239, 169, 255, 245, 255,},
  {83, 124, 207, 141, 168, 240, 170, 255, 245, 255,},
  {84, 125, 208, 142, 168, 240, 171, 255, 246, 255,},
  {85, 126, 209, 142, 169, 241, 172, 255, 246, 255,},
  {86, 127, 210, 143, 169, 241, 173, 255, 247, 255,},
  {87, 129, 211, 144, 170, 242, 174, 255, 247, 255,},
  {88, 130, 212, 144, 170, 242, 175, 255, 247, 255,},
  {89, 131, 213, 145, 171, 243, 175, 255, 248, 255,},
  {90, 132, 214, 146, 171, 243, 176, 255, 248, 255,},
  {91, 133, 215, 146, 171, 244, 177, 255, 248, 255,},
  {92, 134, 216, 147, 172, 244, 178, 255, 249, 255,},
  {93, 136, 217, 148, 172, 245, 179, 255, 249, 255,},
  {94, 137, 218, 148, 173, 245, 180, 255, 249, 255,},
  {95, 138, 219, 149, 173, 245, 181, 255, 249, 255,},
  {96, 139, 220, 150, 174, 246, 181, 255, 250, 255,},
  {97, 140, 220, 150, 174, 246, 182, 255, 250, 255,},
  {98, 141, 221, 151, 175, 247, 183, 255, 250, 255,},
  {99, 142, 222, 152, 175, 247, 184, 255, 250, 255,},
  {100, 144, 223, 152, 176, 247, 185, 255, 251, 255,},
  {101, 145, 224, 153, 176, 248, 186, 255, 251, 255,},
  {102, 146, 224, 154, 177, 248, 186, 255, 251, 255,},
  {103, 147, 225, 154, 177, 248, 187, 255, 251, 255,},
  {104, 148, 226, 155, 177, 248, 188, 255, 252, 255,},
  {105, 149, 226, 156, 178, 249, 189, 255, 252, 255,},
  {106, 150, 227, 156, 178, 249, 190, 255, 252, 255,},
  {107, 151, 228, 157, 179, 249, 191, 255, 252, 255,},
  {108, 152, 229, 158, 179, 250, 191, 255, 252, 255,},
  {109, 153, 229, 158, 180, 250, 192, 255, 252, 255,},
  {110, 154, 230, 159, 180, 250, 193, 255, 253, 255,},
  {111, 155, 231, 160, 181, 250, 194, 255, 253, 255,},
  {112, 157, 231, 160, 181, 251, 195, 255, 253, 255,},
  {113, 158, 232, 161, 182, 251, 195, 255, 253, 255,},
  {114, 159, 232, 162, 182, 251, 196, 255, 253, 255,},
  {115, 160, 233, 162, 183, 251, 197, 255, 253, 255,},
  {116, 161, 234, 163, 183, 251, 198, 255, 253, 255,},
  {117, 162, 234, 164, 184, 252, 198, 255, 254, 255,},
  {118, 163, 235, 165, 184, 252, 199, 255, 254, 255,},
  {119, 164, 235, 165, 185, 252, 200, 255, 254, 255,},
  {120, 165, 236, 166, 185, 252, 201, 255, 254, 255,},
  {121, 166, 236, 167, 186, 252, 201, 255, 254, 255,},
  {122, 167, 237, 167, 186, 252, 202, 255, 254, 255,},
  {123, 168, 237, 168, 186, 253, 203, 255, 254, 255,},
  {124, 169, 238, 169, 187, 253, 204, 255, 254, 255,},
  {125, 170, 238, 169, 187, 253, 204, 255, 254, 255,},
  {126, 171, 239, 170, 188, 253, 205, 255, 254, 255,},
  {127, 172, 239, 171, 188, 253, 206, 255, 254, 255,},
  {128, 173, 240, 171, 189, 253, 207, 255, 255, 255,},
  {129, 174, 240, 172, 189, 253, 207, 255, 255, 255,},
  {130, 175, 241, 173, 190, 253, 208, 255, 255, 255,},
  {131, 176, 241, 174, 190, 254, 209, 255, 255, 255,},
  {132, 177, 241, 174, 191, 254, 209, 255, 255, 255,},
  {133, 178, 242, 175, 191, 254, 210, 255, 255, 255,},
  {134, 179, 242, 176, 192, 254, 211, 255, 255, 255,},
  {135, 180, 243, 176, 192, 254, 212, 255, 255, 255,},
  {136, 180, 243, 177, 193, 254, 212, 255, 255, 255,},
  {137, 181, 243, 178, 193, 254, 213, 255, 255, 255,},
  {138, 182, 244, 179, 194, 254, 214, 255, 255, 255,},
  {139, 183, 244, 179, 194, 254, 214, 255, 255, 255,},
  {140, 184, 244, 180, 195, 254, 215, 255, 255, 255,},
  {141, 185, 245, 181, 195, 254, 216, 255, 255, 255,},
  {142, 186, 245, 181, 196, 255, 216, 255, 255, 255,},
  {143, 187, 245, 182, 196, 255, 217, 255, 255, 255,},
  {144, 188, 246, 183, 197, 255, 218, 255, 255, 255,},
  {145, 189, 246, 183, 197, 255, 218, 255, 255, 255,},
  {146, 190, 246, 184, 198, 255, 219, 255, 255, 255,},
  {147, 191, 247, 185, 198, 255, 220, 255, 255, 255,},
  {148, 191, 247, 186, 199, 255, 220, 255, 255, 255,},
  {149, 192, 247, 186, 199, 255, 221, 255, 255, 255,},
  {150, 193, 248, 187, 200, 255, 221, 255, 255, 255,},
  {151, 194, 248, 188, 200, 255, 222, 255, 255, 255,},
  {152, 195, 248, 188, 201, 255, 223, 255, 255, 255,},
  {153, 196, 248, 189, 201, 255, 223, 255, 255, 255,},
  {154, 197, 249, 190, 202, 255, 224, 255, 255, 255,},
  {155, 198, 249, 191, 202, 255, 224, 255, 255, 255,},
  {156, 198, 249, 191, 203, 255, 225, 255, 255, 255,},
  {157, 199, 249, 192, 203, 255, 226, 255, 255, 255,},
  {158, 200, 250, 193, 204, 255, 226, 255, 255, 255,},
  {159, 201, 250, 193, 204, 255, 227, 255, 255, 255,},
  {160, 202, 250, 194, 205, 255, 227, 255, 255, 255,},
  {161, 203, 250, 195, 206, 255, 228, 255, 255, 255,},
  {162, 203, 250, 196, 206, 255, 228, 255, 255, 255,},
  {163, 204, 251, 196, 207, 255, 229, 255, 255, 255,},
  {164, 205, 251, 197, 207, 255, 229, 255, 255, 255,},
  {165, 206, 251, 198, 208, 255, 230, 255, 255, 255,},
  {166, 207, 251, 198, 208, 255, 231, 255, 255, 255,},
  {167, 207, 251, 199, 209, 255, 231, 255, 255, 255,},
  {168, 208, 252, 200, 209, 255, 232, 255, 255, 255,},
  {169, 209, 252, 201, 210, 255, 232, 255, 255, 255,},
  {170, 210, 252, 201, 210, 255, 233, 255, 255, 255,},
  {171, 211, 252, 202, 211, 255, 233, 255, 255, 255,},
  {172, 211, 252, 203, 211, 255, 234, 255, 255, 255,},
  {173, 212, 252, 203, 212, 255, 234, 255, 255, 255,},
  {174, 213, 252, 204, 212, 255, 235, 255, 255, 255,},
  {175, 214, 253, 205, 213, 255, 235, 255, 255, 255,},
  {176, 214, 253, 206, 213, 255, 236, 255, 255, 255,},
  {177, 215, 253, 206, 214, 255, 236, 255, 255, 255,},
  {178, 216, 253, 207, 214, 255, 237, 255, 255, 255,},
  {179, 217, 253, 208, 215, 255, 237, 255, 255, 255,},
  {180, 217, 253, 208, 216, 255, 237, 255, 255, 255,},
  {181, 218, 253, 209, 216, 255, 238, 255, 255, 255,},
  {182, 219, 254, 210, 217, 255, 238, 255, 255, 255,},
  {183, 220, 254, 211, 217, 255, 239, 255, 255, 255,},
  {184, 220, 254, 211, 218, 255, 239, 255, 255, 255,},
  {185, 221, 254, 212, 218, 255, 240, 255, 255, 255,},
  {186, 222, 254, 213, 219, 255, 240, 255, 255, 255,},
  {187, 222, 254, 213, 219, 255, 241, 255, 255, 255,},
  {188, 223, 254, 214, 220, 255, 241, 255, 255, 255,},
  {189, 224, 254, 215, 220, 255, 241, 255, 255, 255,},
  {190, 225, 254, 215, 221, 255, 242, 255, 255, 255,},
  {191, 225, 254, 216, 221, 255, 242, 255, 255, 255,},
  {192, 226, 254, 217, 222, 255, 243, 255, 255, 255,},
  {193, 227, 255, 218, 223, 255, 243, 255, 255, 255,},
  {194, 227, 255, 218, 223, 255, 243, 255, 255, 255,},
  {195, 228, 255, 219, 224, 255, 244, 255, 255, 255,},
  {196, 229, 255, 220, 224, 255, 244, 255, 255, 255,},
  {197, 229, 255, 220, 225, 255, 244, 255, 255, 255,},
  {198, 230, 255, 221, 225, 255, 245, 255, 255, 255,},
  {199, 230, 255, 222, 226, 255, 245, 255, 255, 255,},
  {200, 231, 255, 222, 226, 255, 246, 255, 255, 255,},
  {201, 232, 255, 223, 227, 255, 246, 255, 255, 255,},
  {202, 232, 255, 224, 228, 255, 246, 255, 255, 255,},
  {203, 233, 255, 224, 228, 255, 247, 255, 255, 255,},
  {204, 234, 255, 225, 229, 255, 247, 255, 255, 255,},
  {205, 234, 255, 226, 229, 255, 247, 255, 255, 255,},
  {206, 235, 255, 227, 230, 255, 248, 255, 255, 255,},
  {207, 235, 255, 227, 230, 255, 248, 255, 255, 255,},
  {208, 236, 255, 228, 231, 255, 248, 255, 255, 255,},
  {209, 237, 255, 229, 231, 255, 248, 255, 255, 255,},
  {210, 237, 255, 229, 232, 255, 249, 255, 255, 255,},
  {211, 238, 255, 230, 233, 255, 249, 255, 255, 255,},
  {212, 238, 255, 231, 233, 255, 249, 255, 255, 255,},
  {213, 239, 255, 231, 234, 255, 250, 255, 255, 255,},
  {214, 239, 255, 232, 234, 255, 250, 255, 255, 255,},
  {215, 240, 255, 233, 235, 255, 250, 255, 255, 255,},
  {216, 241, 255, 233, 235, 255, 250, 255, 255, 255,},
  {217, 241, 255, 234, 236, 255, 251, 255, 255, 255,},
  {218, 242, 255, 235, 236, 255, 251, 255, 255, 255,},
  {219, 242, 255, 235, 237, 255, 251, 255, 255, 255,},
  {220, 243, 255, 236, 237, 255, 251, 255, 255, 255,},
  {221, 243, 255, 236, 238, 255, 252, 255, 255, 255,},
  {222, 244, 255, 237, 239, 255, 252, 255, 255, 255,},
  {223, 244, 255, 238, 239, 255, 252, 255, 255, 255,},
  {224, 245, 255, 238, 240, 255, 252, 255, 255, 255,},
  {225, 245, 255, 239, 240, 255, 252, 255, 255, 255,},
  {226, 246, 255, 240, 241, 255, 253, 255, 255, 255,},
  {227, 246, 255, 240, 241, 255, 253, 255, 255, 255,},
  {228, 247, 255, 241, 242, 255, 253, 255, 255, 255,},
  {229, 247, 255, 242, 242, 255, 253, 255, 255, 255,},
  {230, 248, 255, 242, 243, 255, 253, 255, 255, 255,},
  {231, 248, 255, 243, 244, 255, 254, 255, 255, 255,},
  {232, 248, 255, 243, 244, 255, 254, 255, 255, 255,},
  {233, 249, 255, 244, 245, 255, 254, 255, 255, 255,},
  {234, 249, 255, 245, 245, 255, 254, 255, 255, 255,},
  {235, 250, 255, 245, 246, 255, 254, 255, 255, 255,},
  {236, 250, 255, 246, 246, 255, 254, 255, 255, 255,},
  {237, 251, 255, 246, 247, 255, 255, 255, 255, 255,},
  {238, 251, 255, 247, 247, 255, 255, 255, 255, 255,},
  {239, 251, 255, 248, 248, 255, 255, 255, 255, 255,},
  {240, 252, 255, 248, 248, 255, 255, 255, 255, 255,},
  {241, 252, 255, 249, 249, 255, 255, 255, 255, 255,},
  {242, 252, 255, 249, 249, 255, 255, 255, 255, 255,},
  {243, 253, 255, 250, 250, 255, 255, 255, 255, 255,},
  {244, 253, 255, 250, 250, 255, 255, 255, 255, 255,},
  {245, 253, 255, 251, 251, 255, 255, 255, 255, 255,},
  {246, 254, 255, 251, 251, 255, 255, 255, 255, 255,},
  {247, 254, 255, 252, 252, 255, 255, 255, 255, 255,},
  {248, 254, 255, 252, 252, 255, 255, 255, 255, 255,},
  {249, 255, 255, 253, 253, 255, 255, 255, 255, 255,},
  {250, 255, 255, 253, 253, 255, 255, 255, 255, 255,},
  {251, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
  {252, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
  {253, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {254, 255, 255, 255, 255, 255, 255, 255, 255, 255,},
  {255, 255, 255, 255, 255, 255, 255, 255, 255, 255,}
};

const vp9_prob vp9_modelcoefprobs_gg625[COEFPROB_MODELS][ENTROPY_NODES - 1] = {
  // Probs generated with a Generalized Gaussian (with shape parameter 0.625)
  // source model with varying quantizer step size for a uniform quantizer
  {0,   0,   0,   0,   0,   0,   0,   0,   0,   0,},  // do not use
  {1,   2,   6,  88, 130,  10,  88,  35,  94,  40,},
  {2,   4,  11,  89, 131,  19,  90,  60,  99,  67,},
  {3,   6,  15,  90, 132,  27,  92,  80, 103,  88,},
  {4,   7,  20,  91, 132,  34,  93,  97, 107, 105,},
  {5,   9,  24,  92, 133,  41,  94, 112, 110, 120,},
  {6,  11,  28,  93, 134,  48,  95, 125, 113, 132,},
  {7,  13,  33,  93, 134,  54,  97, 136, 116, 143,},
  {8,  14,  36,  94, 135,  60,  98, 146, 119, 152,},
  {9,  16,  40,  95, 135,  65,  99, 155, 122, 161,},
  {10,  18,  44,  95, 136,  70, 100, 163, 125, 168,},
  {11,  19,  48,  96, 136,  75, 101, 170, 127, 175,},
  {12,  21,  51,  97, 137,  80, 102, 176, 130, 181,},
  {13,  23,  55,  97, 137,  85, 102, 182, 132, 187,},
  {14,  24,  58,  98, 138,  89, 103, 188, 135, 192,},
  {15,  26,  61,  99, 138,  94, 104, 193, 137, 196,},
  {16,  27,  64,  99, 139,  98, 105, 197, 140, 201,},
  {17,  29,  67, 100, 139, 102, 106, 201, 142, 205,},
  {18,  30,  70, 101, 140, 106, 107, 205, 144, 208,},
  {19,  32,  73, 101, 140, 109, 108, 209, 146, 211,},
  {20,  34,  76, 102, 140, 113, 109, 212, 148, 214,},
  {21,  35,  79, 102, 141, 116, 109, 215, 151, 217,},
  {22,  37,  82, 103, 141, 120, 110, 218, 153, 220,},
  {23,  38,  85, 103, 142, 123, 111, 220, 155, 222,},
  {24,  40,  87, 104, 142, 126, 112, 223, 157, 224,},
  {25,  41,  90, 105, 143, 129, 113, 225, 159, 226,},
  {26,  42,  93, 105, 143, 132, 113, 227, 161, 228,},
  {27,  44,  95, 106, 143, 135, 114, 229, 162, 230,},
  {28,  45,  98, 106, 144, 138, 115, 230, 164, 232,},
  {29,  47, 100, 107, 144, 141, 116, 232, 166, 233,},
  {30,  48, 103, 107, 145, 144, 117, 234, 168, 235,},
  {31,  50, 105, 108, 145, 146, 117, 235, 170, 236,},
  {32,  51, 107, 108, 145, 149, 118, 236, 171, 237,},
  {33,  52, 110, 109, 146, 151, 119, 238, 173, 238,},
  {34,  54, 112, 110, 146, 154, 120, 239, 175, 239,},
  {35,  55, 114, 110, 147, 156, 120, 240, 176, 240,},
  {36,  57, 116, 111, 147, 158, 121, 241, 178, 241,},
  {37,  58, 119, 111, 147, 161, 122, 242, 180, 242,},
  {38,  59, 121, 112, 148, 163, 123, 243, 181, 243,},
  {39,  61, 123, 112, 148, 165, 123, 244, 183, 244,},
  {40,  62, 125, 113, 148, 167, 124, 244, 184, 245,},
  {41,  63, 127, 113, 149, 169, 125, 245, 186, 245,},
  {42,  65, 129, 114, 149, 171, 126, 246, 187, 246,},
  {43,  66, 131, 114, 150, 173, 126, 246, 188, 247,},
  {44,  67, 133, 115, 150, 175, 127, 247, 190, 247,},
  {45,  69, 135, 115, 150, 177, 128, 247, 191, 248,},
  {46,  70, 136, 116, 151, 178, 129, 248, 193, 248,},
  {47,  71, 138, 116, 151, 180, 129, 248, 194, 249,},
  {48,  73, 140, 117, 151, 182, 130, 249, 195, 249,},
  {49,  74, 142, 118, 152, 184, 131, 249, 197, 250,},
  {50,  75, 144, 118, 152, 185, 131, 250, 198, 250,},
  {51,  76, 145, 119, 153, 187, 132, 250, 199, 250,},
  {52,  78, 147, 119, 153, 188, 133, 251, 200, 251,},
  {53,  79, 149, 120, 153, 190, 134, 251, 201, 251,},
  {54,  80, 151, 120, 154, 192, 134, 251, 203, 251,},
  {55,  82, 152, 121, 154, 193, 135, 251, 204, 252,},
  {56,  83, 154, 121, 154, 194, 136, 252, 205, 252,},
  {57,  84, 155, 122, 155, 196, 136, 252, 206, 252,},
  {58,  85, 157, 122, 155, 197, 137, 252, 207, 252,},
  {59,  86, 158, 123, 156, 199, 138, 252, 208, 252,},
  {60,  88, 160, 123, 156, 200, 139, 253, 209, 253,},
  {61,  89, 162, 124, 156, 201, 139, 253, 210, 253,},
  {62,  90, 163, 124, 157, 202, 140, 253, 211, 253,},
  {63,  91, 164, 125, 157, 204, 141, 253, 212, 253,},
  {64,  93, 166, 125, 157, 205, 141, 253, 213, 253,},
  {65,  94, 167, 126, 158, 206, 142, 254, 214, 254,},
  {66,  95, 169, 126, 158, 207, 143, 254, 215, 254,},
  {67,  96, 170, 127, 158, 208, 143, 254, 216, 254,},
  {68,  97, 172, 127, 159, 209, 144, 254, 217, 254,},
  {69,  98, 173, 128, 159, 210, 145, 254, 218, 254,},
  {70, 100, 174, 128, 160, 212, 146, 254, 219, 254,},
  {71, 101, 176, 129, 160, 213, 146, 254, 220, 254,},
  {72, 102, 177, 130, 160, 214, 147, 254, 220, 254,},
  {73, 103, 178, 130, 161, 215, 148, 255, 221, 255,},
  {74, 104, 179, 131, 161, 216, 148, 255, 222, 255,},
  {75, 105, 181, 131, 161, 217, 149, 255, 223, 255,},
  {76, 107, 182, 132, 162, 217, 150, 255, 224, 255,},
  {77, 108, 183, 132, 162, 218, 150, 255, 224, 255,},
  {78, 109, 184, 133, 163, 219, 151, 255, 225, 255,},
  {79, 110, 185, 133, 163, 220, 152, 255, 226, 255,},
  {80, 111, 187, 134, 163, 221, 153, 255, 227, 255,},
  {81, 112, 188, 134, 164, 222, 153, 255, 227, 255,},
  {82, 113, 189, 135, 164, 223, 154, 255, 228, 255,},
  {83, 115, 190, 135, 164, 223, 155, 255, 229, 255,},
  {84, 116, 191, 136, 165, 224, 155, 255, 229, 255,},
  {85, 117, 192, 136, 165, 225, 156, 255, 230, 255,},
  {86, 118, 193, 137, 165, 226, 157, 255, 231, 255,},
  {87, 119, 194, 137, 166, 226, 157, 255, 231, 255,},
  {88, 120, 195, 138, 166, 227, 158, 255, 232, 255,},
  {89, 121, 196, 139, 167, 228, 159, 255, 232, 255,},
  {90, 122, 197, 139, 167, 229, 159, 255, 233, 255,},
  {91, 123, 198, 140, 167, 229, 160, 255, 234, 255,},
  {92, 124, 199, 140, 168, 230, 161, 255, 234, 255,},
  {93, 125, 200, 141, 168, 231, 162, 255, 235, 255,},
  {94, 127, 201, 141, 168, 231, 162, 255, 235, 255,},
  {95, 128, 202, 142, 169, 232, 163, 255, 236, 255,},
  {96, 129, 203, 142, 169, 232, 164, 255, 236, 255,},
  {97, 130, 204, 143, 170, 233, 164, 255, 237, 255,},
  {98, 131, 205, 143, 170, 234, 165, 255, 237, 255,},
  {99, 132, 206, 144, 170, 234, 166, 255, 238, 255,},
  {100, 133, 207, 144, 171, 235, 166, 255, 238, 255,},
  {101, 134, 208, 145, 171, 235, 167, 255, 239, 255,},
  {102, 135, 209, 146, 171, 236, 168, 255, 239, 255,},
  {103, 136, 209, 146, 172, 236, 168, 255, 240, 255,},
  {104, 137, 210, 147, 172, 237, 169, 255, 240, 255,},
  {105, 138, 211, 147, 173, 237, 170, 255, 240, 255,},
  {106, 139, 212, 148, 173, 238, 170, 255, 241, 255,},
  {107, 140, 213, 148, 173, 238, 171, 255, 241, 255,},
  {108, 141, 213, 149, 174, 239, 172, 255, 242, 255,},
  {109, 142, 214, 149, 174, 239, 172, 255, 242, 255,},
  {110, 143, 215, 150, 175, 240, 173, 255, 242, 255,},
  {111, 144, 216, 151, 175, 240, 174, 255, 243, 255,},
  {112, 145, 217, 151, 175, 240, 174, 255, 243, 255,},
  {113, 146, 217, 152, 176, 241, 175, 255, 244, 255,},
  {114, 147, 218, 152, 176, 241, 176, 255, 244, 255,},
  {115, 148, 219, 153, 176, 242, 177, 255, 244, 255,},
  {116, 149, 219, 153, 177, 242, 177, 255, 245, 255,},
  {117, 150, 220, 154, 177, 242, 178, 255, 245, 255,},
  {118, 151, 221, 155, 178, 243, 179, 255, 245, 255,},
  {119, 152, 222, 155, 178, 243, 179, 255, 245, 255,},
  {120, 153, 222, 156, 178, 244, 180, 255, 246, 255,},
  {121, 154, 223, 156, 179, 244, 181, 255, 246, 255,},
  {122, 155, 224, 157, 179, 244, 181, 255, 246, 255,},
  {123, 156, 224, 157, 180, 245, 182, 255, 247, 255,},
  {124, 157, 225, 158, 180, 245, 183, 255, 247, 255,},
  {125, 158, 225, 159, 180, 245, 183, 255, 247, 255,},
  {126, 159, 226, 159, 181, 246, 184, 255, 247, 255,},
  {127, 160, 227, 160, 181, 246, 185, 255, 248, 255,},
  {128, 161, 227, 160, 182, 246, 185, 255, 248, 255,},
  {129, 162, 228, 161, 182, 246, 186, 255, 248, 255,},
  {130, 163, 228, 161, 182, 247, 187, 255, 248, 255,},
  {131, 164, 229, 162, 183, 247, 187, 255, 249, 255,},
  {132, 165, 230, 163, 183, 247, 188, 255, 249, 255,},
  {133, 166, 230, 163, 184, 248, 189, 255, 249, 255,},
  {134, 166, 231, 164, 184, 248, 189, 255, 249, 255,},
  {135, 167, 231, 164, 184, 248, 190, 255, 250, 255,},
  {136, 168, 232, 165, 185, 248, 191, 255, 250, 255,},
  {137, 169, 232, 166, 185, 248, 191, 255, 250, 255,},
  {138, 170, 233, 166, 186, 249, 192, 255, 250, 255,},
  {139, 171, 233, 167, 186, 249, 192, 255, 250, 255,},
  {140, 172, 234, 167, 187, 249, 193, 255, 251, 255,},
  {141, 173, 234, 168, 187, 249, 194, 255, 251, 255,},
  {142, 174, 235, 169, 187, 250, 194, 255, 251, 255,},
  {143, 175, 235, 169, 188, 250, 195, 255, 251, 255,},
  {144, 176, 236, 170, 188, 250, 196, 255, 251, 255,},
  {145, 177, 236, 170, 189, 250, 196, 255, 251, 255,},
  {146, 177, 237, 171, 189, 250, 197, 255, 252, 255,},
  {147, 178, 237, 172, 189, 251, 198, 255, 252, 255,},
  {148, 179, 238, 172, 190, 251, 198, 255, 252, 255,},
  {149, 180, 238, 173, 190, 251, 199, 255, 252, 255,},
  {150, 181, 238, 173, 191, 251, 200, 255, 252, 255,},
  {151, 182, 239, 174, 191, 251, 200, 255, 252, 255,},
  {152, 183, 239, 175, 192, 251, 201, 255, 252, 255,},
  {153, 184, 240, 175, 192, 252, 202, 255, 252, 255,},
  {154, 184, 240, 176, 193, 252, 202, 255, 253, 255,},
  {155, 185, 240, 177, 193, 252, 203, 255, 253, 255,},
  {156, 186, 241, 177, 193, 252, 203, 255, 253, 255,},
  {157, 187, 241, 178, 194, 252, 204, 255, 253, 255,},
  {158, 188, 242, 178, 194, 252, 205, 255, 253, 255,},
  {159, 189, 242, 179, 195, 252, 205, 255, 253, 255,},
  {160, 190, 242, 180, 195, 253, 206, 255, 253, 255,},
  {161, 190, 243, 180, 196, 253, 207, 255, 253, 255,},
  {162, 191, 243, 181, 196, 253, 207, 255, 254, 255,},
  {163, 192, 243, 182, 197, 253, 208, 255, 254, 255,},
  {164, 193, 244, 182, 197, 253, 209, 255, 254, 255,},
  {165, 194, 244, 183, 197, 253, 209, 255, 254, 255,},
  {166, 195, 244, 184, 198, 253, 210, 255, 254, 255,},
  {167, 196, 245, 184, 198, 253, 210, 255, 254, 255,},
  {168, 196, 245, 185, 199, 253, 211, 255, 254, 255,},
  {169, 197, 245, 186, 199, 254, 212, 255, 254, 255,},
  {170, 198, 246, 186, 200, 254, 212, 255, 254, 255,},
  {171, 199, 246, 187, 200, 254, 213, 255, 254, 255,},
  {172, 200, 246, 188, 201, 254, 214, 255, 254, 255,},
  {173, 200, 246, 188, 201, 254, 214, 255, 254, 255,},
  {174, 201, 247, 189, 202, 254, 215, 255, 254, 255,},
  {175, 202, 247, 189, 202, 254, 215, 255, 255, 255,},
  {176, 203, 247, 190, 203, 254, 216, 255, 255, 255,},
  {177, 204, 248, 191, 203, 254, 217, 255, 255, 255,},
  {178, 204, 248, 191, 204, 254, 217, 255, 255, 255,},
  {179, 205, 248, 192, 204, 254, 218, 255, 255, 255,},
  {180, 206, 248, 193, 204, 254, 218, 255, 255, 255,},
  {181, 207, 249, 194, 205, 255, 219, 255, 255, 255,},
  {182, 208, 249, 194, 205, 255, 220, 255, 255, 255,},
  {183, 208, 249, 195, 206, 255, 220, 255, 255, 255,},
  {184, 209, 249, 196, 206, 255, 221, 255, 255, 255,},
  {185, 210, 250, 196, 207, 255, 221, 255, 255, 255,},
  {186, 211, 250, 197, 207, 255, 222, 255, 255, 255,},
  {187, 211, 250, 198, 208, 255, 223, 255, 255, 255,},
  {188, 212, 250, 198, 208, 255, 223, 255, 255, 255,},
  {189, 213, 250, 199, 209, 255, 224, 255, 255, 255,},
  {190, 214, 251, 200, 209, 255, 224, 255, 255, 255,},
  {191, 215, 251, 200, 210, 255, 225, 255, 255, 255,},
  {192, 215, 251, 201, 211, 255, 225, 255, 255, 255,},
  {193, 216, 251, 202, 211, 255, 226, 255, 255, 255,},
  {194, 217, 251, 203, 212, 255, 227, 255, 255, 255,},
  {195, 218, 252, 203, 212, 255, 227, 255, 255, 255,},
  {196, 218, 252, 204, 213, 255, 228, 255, 255, 255,},
  {197, 219, 252, 205, 213, 255, 228, 255, 255, 255,},
  {198, 220, 252, 205, 214, 255, 229, 255, 255, 255,},
  {199, 221, 252, 206, 214, 255, 229, 255, 255, 255,},
  {200, 221, 252, 207, 215, 255, 230, 255, 255, 255,},
  {201, 222, 252, 208, 215, 255, 231, 255, 255, 255,},
  {202, 223, 253, 208, 216, 255, 231, 255, 255, 255,},
  {203, 223, 253, 209, 216, 255, 232, 255, 255, 255,},
  {204, 224, 253, 210, 217, 255, 232, 255, 255, 255,},
  {205, 225, 253, 211, 218, 255, 233, 255, 255, 255,},
  {206, 226, 253, 211, 218, 255, 233, 255, 255, 255,},
  {207, 226, 253, 212, 219, 255, 234, 255, 255, 255,},
  {208, 227, 253, 213, 219, 255, 234, 255, 255, 255,},
  {209, 228, 254, 214, 220, 255, 235, 255, 255, 255,},
  {210, 228, 254, 214, 220, 255, 236, 255, 255, 255,},
  {211, 229, 254, 215, 221, 255, 236, 255, 255, 255,},
  {212, 230, 254, 216, 222, 255, 237, 255, 255, 255,},
  {213, 230, 254, 217, 222, 255, 237, 255, 255, 255,},
  {214, 231, 254, 217, 223, 255, 238, 255, 255, 255,},
  {215, 232, 254, 218, 223, 255, 238, 255, 255, 255,},
  {216, 233, 254, 219, 224, 255, 239, 255, 255, 255,},
  {217, 233, 254, 220, 225, 255, 239, 255, 255, 255,},
  {218, 234, 255, 220, 225, 255, 240, 255, 255, 255,},
  {219, 235, 255, 221, 226, 255, 240, 255, 255, 255,},
  {220, 235, 255, 222, 226, 255, 241, 255, 255, 255,},
  {221, 236, 255, 223, 227, 255, 241, 255, 255, 255,},
  {222, 237, 255, 224, 228, 255, 242, 255, 255, 255,},
  {223, 237, 255, 224, 228, 255, 242, 255, 255, 255,},
  {224, 238, 255, 225, 229, 255, 243, 255, 255, 255,},
  {225, 238, 255, 226, 230, 255, 243, 255, 255, 255,},
  {226, 239, 255, 227, 230, 255, 244, 255, 255, 255,},
  {227, 240, 255, 228, 231, 255, 244, 255, 255, 255,},
  {228, 240, 255, 228, 232, 255, 245, 255, 255, 255,},
  {229, 241, 255, 229, 232, 255, 245, 255, 255, 255,},
  {230, 242, 255, 230, 233, 255, 246, 255, 255, 255,},
  {231, 242, 255, 231, 234, 255, 246, 255, 255, 255,},
  {232, 243, 255, 232, 234, 255, 247, 255, 255, 255,},
  {233, 243, 255, 233, 235, 255, 247, 255, 255, 255,},
  {234, 244, 255, 233, 236, 255, 247, 255, 255, 255,},
  {235, 245, 255, 234, 236, 255, 248, 255, 255, 255,},
  {236, 245, 255, 235, 237, 255, 248, 255, 255, 255,},
  {237, 246, 255, 236, 238, 255, 249, 255, 255, 255,},
  {238, 247, 255, 237, 239, 255, 249, 255, 255, 255,},
  {239, 247, 255, 238, 239, 255, 250, 255, 255, 255,},
  {240, 248, 255, 239, 240, 255, 250, 255, 255, 255,},
  {241, 248, 255, 240, 241, 255, 251, 255, 255, 255,},
  {242, 249, 255, 241, 242, 255, 251, 255, 255, 255,},
  {243, 249, 255, 241, 243, 255, 251, 255, 255, 255,},
  {244, 250, 255, 242, 243, 255, 252, 255, 255, 255,},
  {245, 251, 255, 243, 244, 255, 252, 255, 255, 255,},
  {246, 251, 255, 244, 245, 255, 253, 255, 255, 255,},
  {247, 252, 255, 245, 246, 255, 253, 255, 255, 255,},
  {248, 252, 255, 246, 247, 255, 253, 255, 255, 255,},
  {249, 253, 255, 247, 248, 255, 254, 255, 255, 255,},
  {250, 253, 255, 248, 249, 255, 254, 255, 255, 255,},
  {251, 254, 255, 249, 250, 255, 254, 255, 255, 255,},
  {252, 254, 255, 251, 251, 255, 255, 255, 255, 255,},
  {253, 255, 255, 252, 252, 255, 255, 255, 255, 255,},
  {254, 255, 255, 253, 253, 255, 255, 255, 255, 255,},
  {255, 255, 255, 254, 254, 255, 255, 255, 255, 255,},
};

const vp9_prob vp9_modelcoefprobs_gg50[COEFPROB_MODELS][ENTROPY_NODES - 1] = {
  // Probs generated with a Generalized Gaussian (with shape parameter 0.5)
  // source model with varying quantizer step size for a uniform quantizer
  {0,   0,   0,   0,   0,   0,   0,   0,   0,   0,},  // do not use
  {1,   2,   5,  89, 131,   9,  90,  30,  95,  33,},
  {2,   4,  10,  90, 132,  17,  91,  51, 100,  54,},
  {3,   5,  14,  91, 133,  24,  93,  67, 103,  70,},
  {4,   7,  18,  92, 133,  30,  94,  81, 106,  83,},
  {5,   9,  22,  93, 134,  35,  95,  93, 109,  95,},
  {6,  10,  26,  94, 135,  41,  96, 104, 112, 105,},
  {7,  12,  29,  95, 135,  46,  97, 113, 114, 114,},
  {8,  14,  32,  96, 136,  50,  98, 122, 116, 122,},
  {9,  15,  36,  96, 136,  55,  99, 130, 118, 129,},
  {10,  17,  39,  97, 137,  59, 100, 137, 120, 135,},
  {11,  18,  42,  98, 137,  63, 101, 143, 122, 141,},
  {12,  20,  45,  98, 138,  67, 101, 149, 124, 147,},
  {13,  21,  48,  99, 138,  71, 102, 155, 126, 152,},
  {14,  23,  51,  99, 139,  75, 103, 160, 128, 157,},
  {15,  24,  54, 100, 139,  78, 104, 165, 129, 161,},
  {16,  25,  56, 101, 140,  82, 104, 169, 131, 166,},
  {17,  27,  59, 101, 140,  85, 105, 173, 133, 169,},
  {18,  28,  62, 102, 140,  88, 106, 177, 134, 173,},
  {19,  30,  64, 102, 141,  91, 106, 181, 136, 177,},
  {20,  31,  67, 103, 141,  94, 107, 184, 138, 180,},
  {21,  32,  69, 103, 142,  97, 108, 187, 139, 183,},
  {22,  34,  71, 104, 142, 100, 108, 191, 141, 186,},
  {23,  35,  74, 104, 142, 103, 109, 193, 142, 189,},
  {24,  36,  76, 105, 143, 106, 110, 196, 143, 191,},
  {25,  38,  78, 105, 143, 108, 110, 199, 145, 194,},
  {26,  39,  81, 106, 144, 111, 111, 201, 146, 196,},
  {27,  40,  83, 106, 144, 113, 111, 204, 148, 199,},
  {28,  42,  85, 107, 144, 116, 112, 206, 149, 201,},
  {29,  43,  87, 107, 145, 118, 113, 208, 150, 203,},
  {30,  44,  89, 108, 145, 121, 113, 210, 152, 205,},
  {31,  45,  91, 108, 145, 123, 114, 212, 153, 207,},
  {32,  47,  93, 109, 146, 125, 114, 214, 154, 209,},
  {33,  48,  95, 109, 146, 127, 115, 215, 155, 210,},
  {34,  49,  97, 109, 146, 129, 116, 217, 157, 212,},
  {35,  50,  99, 110, 147, 132, 116, 219, 158, 213,},
  {36,  52, 101, 110, 147, 134, 117, 220, 159, 215,},
  {37,  53, 103, 111, 147, 136, 117, 222, 160, 216,},
  {38,  54, 105, 111, 148, 138, 118, 223, 161, 218,},
  {39,  55, 107, 112, 148, 140, 118, 224, 163, 219,},
  {40,  57, 109, 112, 148, 141, 119, 226, 164, 221,},
  {41,  58, 110, 113, 149, 143, 119, 227, 165, 222,},
  {42,  59, 112, 113, 149, 145, 120, 228, 166, 223,},
  {43,  60, 114, 113, 149, 147, 120, 229, 167, 224,},
  {44,  61, 116, 114, 149, 149, 121, 230, 168, 225,},
  {45,  63, 117, 114, 150, 150, 122, 231, 169, 226,},
  {46,  64, 119, 115, 150, 152, 122, 232, 170, 227,},
  {47,  65, 121, 115, 150, 154, 123, 233, 171, 228,},
  {48,  66, 122, 116, 151, 155, 123, 234, 173, 229,},
  {49,  67, 124, 116, 151, 157, 124, 235, 174, 230,},
  {50,  68, 125, 116, 151, 159, 124, 236, 175, 231,},
  {51,  69, 127, 117, 152, 160, 125, 236, 176, 232,},
  {52,  71, 128, 117, 152, 162, 125, 237, 177, 233,},
  {53,  72, 130, 118, 152, 163, 126, 238, 178, 233,},
  {54,  73, 132, 118, 153, 165, 126, 239, 179, 234,},
  {55,  74, 133, 119, 153, 166, 127, 239, 180, 235,},
  {56,  75, 134, 119, 153, 168, 127, 240, 181, 236,},
  {57,  76, 136, 119, 153, 169, 128, 240, 182, 236,},
  {58,  77, 137, 120, 154, 170, 128, 241, 183, 237,},
  {59,  78, 139, 120, 154, 172, 129, 242, 183, 238,},
  {60,  80, 140, 121, 154, 173, 129, 242, 184, 238,},
  {61,  81, 142, 121, 155, 174, 130, 243, 185, 239,},
  {62,  82, 143, 121, 155, 176, 130, 243, 186, 239,},
  {63,  83, 144, 122, 155, 177, 131, 244, 187, 240,},
  {64,  84, 146, 122, 156, 178, 132, 244, 188, 241,},
  {65,  85, 147, 123, 156, 179, 132, 245, 189, 241,},
  {66,  86, 148, 123, 156, 181, 133, 245, 190, 242,},
  {67,  87, 150, 124, 156, 182, 133, 245, 191, 242,},
  {68,  88, 151, 124, 157, 183, 134, 246, 192, 242,},
  {69,  89, 152, 124, 157, 184, 134, 246, 192, 243,},
  {70,  90, 154, 125, 157, 185, 135, 247, 193, 243,},
  {71,  91, 155, 125, 158, 186, 135, 247, 194, 244,},
  {72,  92, 156, 126, 158, 188, 136, 247, 195, 244,},
  {73,  93, 157, 126, 158, 189, 136, 248, 196, 245,},
  {74,  95, 158, 126, 159, 190, 137, 248, 197, 245,},
  {75,  96, 160, 127, 159, 191, 137, 248, 197, 245,},
  {76,  97, 161, 127, 159, 192, 138, 249, 198, 246,},
  {77,  98, 162, 128, 159, 193, 138, 249, 199, 246,},
  {78,  99, 163, 128, 160, 194, 139, 249, 200, 246,},
  {79, 100, 164, 129, 160, 195, 139, 249, 200, 247,},
  {80, 101, 165, 129, 160, 196, 140, 250, 201, 247,},
  {81, 102, 167, 129, 161, 197, 140, 250, 202, 247,},
  {82, 103, 168, 130, 161, 198, 141, 250, 203, 248,},
  {83, 104, 169, 130, 161, 199, 141, 250, 204, 248,},
  {84, 105, 170, 131, 161, 200, 142, 251, 204, 248,},
  {85, 106, 171, 131, 162, 201, 142, 251, 205, 248,},
  {86, 107, 172, 132, 162, 202, 143, 251, 206, 249,},
  {87, 108, 173, 132, 162, 202, 143, 251, 206, 249,},
  {88, 109, 174, 132, 163, 203, 144, 251, 207, 249,},
  {89, 110, 175, 133, 163, 204, 144, 252, 208, 249,},
  {90, 111, 176, 133, 163, 205, 145, 252, 209, 250,},
  {91, 112, 177, 134, 164, 206, 145, 252, 209, 250,},
  {92, 113, 178, 134, 164, 207, 146, 252, 210, 250,},
  {93, 114, 179, 134, 164, 208, 146, 252, 211, 250,},
  {94, 115, 180, 135, 164, 208, 147, 252, 211, 250,},
  {95, 116, 181, 135, 165, 209, 147, 252, 212, 251,},
  {96, 117, 182, 136, 165, 210, 148, 253, 213, 251,},
  {97, 118, 183, 136, 165, 211, 148, 253, 213, 251,},
  {98, 119, 184, 137, 166, 211, 149, 253, 214, 251,},
  {99, 120, 185, 137, 166, 212, 149, 253, 214, 251,},
  {100, 121, 186, 137, 166, 213, 150, 253, 215, 252,},
  {101, 122, 187, 138, 167, 214, 150, 253, 216, 252,},
  {102, 123, 188, 138, 167, 214, 151, 253, 216, 252,},
  {103, 123, 189, 139, 167, 215, 151, 253, 217, 252,},
  {104, 124, 190, 139, 167, 216, 152, 254, 218, 252,},
  {105, 125, 191, 140, 168, 217, 152, 254, 218, 252,},
  {106, 126, 191, 140, 168, 217, 153, 254, 219, 252,},
  {107, 127, 192, 141, 168, 218, 153, 254, 219, 253,},
  {108, 128, 193, 141, 169, 219, 154, 254, 220, 253,},
  {109, 129, 194, 141, 169, 219, 154, 254, 220, 253,},
  {110, 130, 195, 142, 169, 220, 155, 254, 221, 253,},
  {111, 131, 196, 142, 170, 220, 155, 254, 222, 253,},
  {112, 132, 197, 143, 170, 221, 156, 254, 222, 253,},
  {113, 133, 197, 143, 170, 222, 157, 254, 223, 253,},
  {114, 134, 198, 144, 171, 222, 157, 254, 223, 253,},
  {115, 135, 199, 144, 171, 223, 158, 254, 224, 253,},
  {116, 136, 200, 144, 171, 224, 158, 255, 224, 254,},
  {117, 137, 201, 145, 171, 224, 159, 255, 225, 254,},
  {118, 138, 201, 145, 172, 225, 159, 255, 225, 254,},
  {119, 138, 202, 146, 172, 225, 160, 255, 226, 254,},
  {120, 139, 203, 146, 172, 226, 160, 255, 226, 254,},
  {121, 140, 204, 147, 173, 226, 161, 255, 227, 254,},
  {122, 141, 205, 147, 173, 227, 161, 255, 227, 254,},
  {123, 142, 205, 148, 173, 228, 162, 255, 228, 254,},
  {124, 143, 206, 148, 174, 228, 162, 255, 228, 254,},
  {125, 144, 207, 149, 174, 229, 163, 255, 229, 254,},
  {126, 145, 207, 149, 174, 229, 163, 255, 229, 254,},
  {127, 146, 208, 149, 175, 230, 164, 255, 230, 254,},
  {128, 147, 209, 150, 175, 230, 164, 255, 230, 254,},
  {129, 148, 210, 150, 175, 231, 165, 255, 231, 255,},
  {130, 148, 210, 151, 176, 231, 165, 255, 231, 255,},
  {131, 149, 211, 151, 176, 232, 166, 255, 231, 255,},
  {132, 150, 212, 152, 176, 232, 166, 255, 232, 255,},
  {133, 151, 212, 152, 177, 233, 167, 255, 232, 255,},
  {134, 152, 213, 153, 177, 233, 168, 255, 233, 255,},
  {135, 153, 214, 153, 177, 233, 168, 255, 233, 255,},
  {136, 154, 214, 154, 177, 234, 169, 255, 234, 255,},
  {137, 155, 215, 154, 178, 234, 169, 255, 234, 255,},
  {138, 156, 216, 155, 178, 235, 170, 255, 234, 255,},
  {139, 157, 216, 155, 178, 235, 170, 255, 235, 255,},
  {140, 157, 217, 156, 179, 236, 171, 255, 235, 255,},
  {141, 158, 218, 156, 179, 236, 171, 255, 236, 255,},
  {142, 159, 218, 157, 179, 236, 172, 255, 236, 255,},
  {143, 160, 219, 157, 180, 237, 172, 255, 236, 255,},
  {144, 161, 219, 158, 180, 237, 173, 255, 237, 255,},
  {145, 162, 220, 158, 181, 238, 174, 255, 237, 255,},
  {146, 163, 221, 159, 181, 238, 174, 255, 238, 255,},
  {147, 164, 221, 159, 181, 238, 175, 255, 238, 255,},
  {148, 164, 222, 160, 182, 239, 175, 255, 238, 255,},
  {149, 165, 222, 160, 182, 239, 176, 255, 239, 255,},
  {150, 166, 223, 161, 182, 240, 176, 255, 239, 255,},
  {151, 167, 224, 161, 183, 240, 177, 255, 239, 255,},
  {152, 168, 224, 162, 183, 240, 177, 255, 240, 255,},
  {153, 169, 225, 162, 183, 241, 178, 255, 240, 255,},
  {154, 170, 225, 163, 184, 241, 179, 255, 240, 255,},
  {155, 170, 226, 163, 184, 241, 179, 255, 241, 255,},
  {156, 171, 226, 164, 184, 242, 180, 255, 241, 255,},
  {157, 172, 227, 164, 185, 242, 180, 255, 241, 255,},
  {158, 173, 227, 165, 185, 242, 181, 255, 242, 255,},
  {159, 174, 228, 165, 185, 243, 181, 255, 242, 255,},
  {160, 175, 229, 166, 186, 243, 182, 255, 242, 255,},
  {161, 176, 229, 166, 186, 243, 182, 255, 243, 255,},
  {162, 176, 230, 167, 187, 244, 183, 255, 243, 255,},
  {163, 177, 230, 167, 187, 244, 184, 255, 243, 255,},
  {164, 178, 231, 168, 187, 244, 184, 255, 244, 255,},
  {165, 179, 231, 168, 188, 244, 185, 255, 244, 255,},
  {166, 180, 232, 169, 188, 245, 185, 255, 244, 255,},
  {167, 181, 232, 169, 188, 245, 186, 255, 244, 255,},
  {168, 181, 232, 170, 189, 245, 186, 255, 245, 255,},
  {169, 182, 233, 170, 189, 246, 187, 255, 245, 255,},
  {170, 183, 233, 171, 190, 246, 188, 255, 245, 255,},
  {171, 184, 234, 172, 190, 246, 188, 255, 245, 255,},
  {172, 185, 234, 172, 190, 246, 189, 255, 246, 255,},
  {173, 186, 235, 173, 191, 247, 189, 255, 246, 255,},
  {174, 186, 235, 173, 191, 247, 190, 255, 246, 255,},
  {175, 187, 236, 174, 191, 247, 191, 255, 246, 255,},
  {176, 188, 236, 174, 192, 247, 191, 255, 247, 255,},
  {177, 189, 237, 175, 192, 248, 192, 255, 247, 255,},
  {178, 190, 237, 176, 193, 248, 192, 255, 247, 255,},
  {179, 191, 237, 176, 193, 248, 193, 255, 247, 255,},
  {180, 191, 238, 177, 194, 248, 194, 255, 248, 255,},
  {181, 192, 238, 177, 194, 249, 194, 255, 248, 255,},
  {182, 193, 239, 178, 194, 249, 195, 255, 248, 255,},
  {183, 194, 239, 178, 195, 249, 195, 255, 248, 255,},
  {184, 195, 239, 179, 195, 249, 196, 255, 249, 255,},
  {185, 196, 240, 180, 196, 249, 197, 255, 249, 255,},
  {186, 196, 240, 180, 196, 250, 197, 255, 249, 255,},
  {187, 197, 241, 181, 196, 250, 198, 255, 249, 255,},
  {188, 198, 241, 182, 197, 250, 199, 255, 249, 255,},
  {189, 199, 241, 182, 197, 250, 199, 255, 250, 255,},
  {190, 200, 242, 183, 198, 250, 200, 255, 250, 255,},
  {191, 200, 242, 183, 198, 251, 200, 255, 250, 255,},
  {192, 201, 242, 184, 199, 251, 201, 255, 250, 255,},
  {193, 202, 243, 185, 199, 251, 202, 255, 250, 255,},
  {194, 203, 243, 185, 200, 251, 202, 255, 251, 255,},
  {195, 204, 244, 186, 200, 251, 203, 255, 251, 255,},
  {196, 205, 244, 187, 200, 251, 204, 255, 251, 255,},
  {197, 205, 244, 187, 201, 252, 204, 255, 251, 255,},
  {198, 206, 245, 188, 201, 252, 205, 255, 251, 255,},
  {199, 207, 245, 189, 202, 252, 206, 255, 251, 255,},
  {200, 208, 245, 189, 202, 252, 206, 255, 252, 255,},
  {201, 209, 246, 190, 203, 252, 207, 255, 252, 255,},
  {202, 209, 246, 191, 203, 252, 207, 255, 252, 255,},
  {203, 210, 246, 191, 204, 252, 208, 255, 252, 255,},
  {204, 211, 246, 192, 204, 253, 209, 255, 252, 255,},
  {205, 212, 247, 193, 205, 253, 209, 255, 252, 255,},
  {206, 213, 247, 193, 205, 253, 210, 255, 252, 255,},
  {207, 213, 247, 194, 206, 253, 211, 255, 253, 255,},
  {208, 214, 248, 195, 206, 253, 212, 255, 253, 255,},
  {209, 215, 248, 196, 207, 253, 212, 255, 253, 255,},
  {210, 216, 248, 196, 207, 253, 213, 255, 253, 255,},
  {211, 217, 249, 197, 208, 253, 214, 255, 253, 255,},
  {212, 218, 249, 198, 209, 254, 214, 255, 253, 255,},
  {213, 218, 249, 199, 209, 254, 215, 255, 253, 255,},
  {214, 219, 249, 199, 210, 254, 216, 255, 253, 255,},
  {215, 220, 250, 200, 210, 254, 216, 255, 254, 255,},
  {216, 221, 250, 201, 211, 254, 217, 255, 254, 255,},
  {217, 222, 250, 202, 211, 254, 218, 255, 254, 255,},
  {218, 222, 250, 202, 212, 254, 219, 255, 254, 255,},
  {219, 223, 251, 203, 213, 254, 219, 255, 254, 255,},
  {220, 224, 251, 204, 213, 254, 220, 255, 254, 255,},
  {221, 225, 251, 205, 214, 254, 221, 255, 254, 255,},
  {222, 226, 251, 206, 214, 255, 221, 255, 254, 255,},
  {223, 226, 251, 207, 215, 255, 222, 255, 254, 255,},
  {224, 227, 252, 208, 216, 255, 223, 255, 255, 255,},
  {225, 228, 252, 208, 216, 255, 224, 255, 255, 255,},
  {226, 229, 252, 209, 217, 255, 224, 255, 255, 255,},
  {227, 230, 252, 210, 218, 255, 225, 255, 255, 255,},
  {228, 231, 253, 211, 218, 255, 226, 255, 255, 255,},
  {229, 231, 253, 212, 219, 255, 227, 255, 255, 255,},
  {230, 232, 253, 213, 220, 255, 228, 255, 255, 255,},
  {231, 233, 253, 214, 220, 255, 228, 255, 255, 255,},
  {232, 234, 253, 215, 221, 255, 229, 255, 255, 255,},
  {233, 235, 253, 216, 222, 255, 230, 255, 255, 255,},
  {234, 235, 254, 217, 223, 255, 231, 255, 255, 255,},
  {235, 236, 254, 218, 224, 255, 232, 255, 255, 255,},
  {236, 237, 254, 219, 224, 255, 233, 255, 255, 255,},
  {237, 238, 254, 220, 225, 255, 233, 255, 255, 255,},
  {238, 239, 254, 221, 226, 255, 234, 255, 255, 255,},
  {239, 240, 254, 222, 227, 255, 235, 255, 255, 255,},
  {240, 241, 255, 223, 228, 255, 236, 255, 255, 255,},
  {241, 241, 255, 225, 229, 255, 237, 255, 255, 255,},
  {242, 242, 255, 226, 230, 255, 238, 255, 255, 255,},
  {243, 243, 255, 227, 231, 255, 239, 255, 255, 255,},
  {244, 244, 255, 228, 232, 255, 240, 255, 255, 255,},
  {245, 245, 255, 230, 233, 255, 241, 255, 255, 255,},
  {246, 246, 255, 231, 234, 255, 242, 255, 255, 255,},
  {247, 247, 255, 233, 235, 255, 243, 255, 255, 255,},
  {248, 248, 255, 234, 236, 255, 244, 255, 255, 255,},
  {249, 248, 255, 236, 238, 255, 245, 255, 255, 255,},
  {250, 249, 255, 238, 239, 255, 246, 255, 255, 255,},
  {251, 250, 255, 239, 241, 255, 247, 255, 255, 255,},
  {252, 251, 255, 241, 243, 255, 249, 255, 255, 255,},
  {253, 252, 255, 244, 244, 255, 250, 255, 255, 255,},
  {254, 253, 255, 246, 247, 255, 251, 255, 255, 255,},
  {255, 255, 255, 249, 250, 255, 253, 255, 255, 255,},
};

void vp9_get_model_distribution(vp9_prob p0, vp9_prob *tree_probs,
                                int b, int r) {
  const vp9_prob (*model)[ENTROPY_NODES - 1];
  if (r != INTRA_FRAME && b == PLANE_TYPE_UV)
    model = vp9_modelcoefprobs_gg75;
  else if (r == INTRA_FRAME && b == PLANE_TYPE_UV)
    model = vp9_modelcoefprobs_gg75;
  else if (r != INTRA_FRAME && b == PLANE_TYPE_Y_WITH_DC)
    model = vp9_modelcoefprobs_gg75;
  else
    model = vp9_modelcoefprobs_gg75;
  vpx_memcpy(tree_probs + 1, model[p0],
             (ENTROPY_NODES - 1) * sizeof(vp9_prob));
}
#endif

static vp9_tree_index cat1[2], cat2[4], cat3[6], cat4[8], cat5[10], cat6[28];

static void init_bit_tree(vp9_tree_index *p, int n) {
  int i = 0;

  while (++i < n) {
    p[0] = p[1] = i << 1;
    p += 2;
  }

  p[0] = p[1] = 0;
}

static void init_bit_trees() {
  init_bit_tree(cat1, 1);
  init_bit_tree(cat2, 2);
  init_bit_tree(cat3, 3);
  init_bit_tree(cat4, 4);
  init_bit_tree(cat5, 5);
  init_bit_tree(cat6, 14);
}

vp9_extra_bit_struct vp9_extra_bits[12] = {
  { 0, 0, 0, 0},
  { 0, 0, 0, 1},
  { 0, 0, 0, 2},
  { 0, 0, 0, 3},
  { 0, 0, 0, 4},
  { cat1, Pcat1, 1, 5},
  { cat2, Pcat2, 2, 7},
  { cat3, Pcat3, 3, 11},
  { cat4, Pcat4, 4, 19},
  { cat5, Pcat5, 5, 35},
  { cat6, Pcat6, 14, 67},
  { 0, 0, 0, 0}
};

#include "vp9/common/vp9_default_coef_probs.h"

// This function updates and then returns n AC coefficient context
// This is currently a placeholder function to allow experimentation
// using various context models based on the energy earlier tokens
// within the current block.
//
// For now it just returns the previously used context.
int vp9_get_coef_context(int * recent_energy, int token) {
  // int token_energy;
  // int av_energy;

  /*token_energy = ((token != DCT_EOB_TOKEN) ? token : 0);
  if (!token_energy) {
    if (!(*recent_energy)) {
      av_energy = 0;
    } else {
      av_energy = 1;
    }
  } else {
    av_energy = ((token_energy + *recent_energy + 1) >> 1) + 1;
    if (av_energy > DCT_VAL_CATEGORY6)
      av_energy = DCT_VAL_CATEGORY6;
  }
  *recent_energy = token_energy;*/

  return vp9_pt_energy_class[token];
};

void vp9_default_coef_probs(VP9_COMMON *pc) {
#if CONFIG_MODELCOEFPROB
  int b, r, c, p;
#endif
#if CONFIG_CODE_NONZEROCOUNT
#ifdef NZC_DEFAULT_COUNTS
  int h, g;
  for (h = 0; h < MAX_NZC_CONTEXTS; ++h) {
    for (g = 0; g < REF_TYPES; ++g) {
      int i;
      unsigned int branch_ct4x4[NZC4X4_NODES][2];
      unsigned int branch_ct8x8[NZC8X8_NODES][2];
      unsigned int branch_ct16x16[NZC16X16_NODES][2];
      unsigned int branch_ct32x32[NZC32X32_NODES][2];
      for (i = 0; i < BLOCK_TYPES; ++i) {
        vp9_tree_probs_from_distribution(
          vp9_nzc4x4_tree,
          pc->fc.nzc_probs_4x4[h][g][i], branch_ct4x4,
          default_nzc_counts_4x4[h][g][i], 0);
      }
      for (i = 0; i < BLOCK_TYPES; ++i) {
        vp9_tree_probs_from_distribution(
          vp9_nzc8x8_tree,
          pc->fc.nzc_probs_8x8[h][g][i], branch_ct8x8,
          default_nzc_counts_8x8[h][g][i], 0);
      }
      for (i = 0; i < BLOCK_TYPES; ++i) {
        vp9_tree_probs_from_distribution(
          vp9_nzc16x16_tree,
          pc->fc.nzc_probs_16x16[h][g][i], branch_ct16x16,
          default_nzc_counts_16x16[h][g][i], 0);
      }
      for (i = 0; i < BLOCK_TYPES; ++i) {
        vp9_tree_probs_from_distribution(
          vp9_nzc32x32_tree,
          pc->fc.nzc_probs_32x32[h][g][i], branch_ct32x32,
          default_nzc_counts_32x32[h][g][i], 0);
      }
    }
  }
#else
  vpx_memcpy(pc->fc.nzc_probs_4x4, default_nzc_probs_4x4,
             sizeof(pc->fc.nzc_probs_4x4));
  vpx_memcpy(pc->fc.nzc_probs_8x8, default_nzc_probs_8x8,
             sizeof(pc->fc.nzc_probs_8x8));
  vpx_memcpy(pc->fc.nzc_probs_16x16, default_nzc_probs_16x16,
             sizeof(pc->fc.nzc_probs_16x16));
  vpx_memcpy(pc->fc.nzc_probs_32x32, default_nzc_probs_32x32,
             sizeof(pc->fc.nzc_probs_32x32));
#endif
  vpx_memcpy(pc->fc.nzc_pcat_probs, default_nzc_pcat_probs,
             sizeof(pc->fc.nzc_pcat_probs));
#endif  // CONFIG_CODE_NONZEROCOUNT
#if CONFIG_MODELCOEFPROB
  for (b = 0; b < BLOCK_TYPES; ++b)
    for (r = 0; r < REF_TYPES; ++r)
      for (c = 0; c < COEF_BANDS; ++c)
        for (p = 0; p < PREV_COEF_CONTEXTS; ++p) {
          pc->fc.coef_probs_4x4[b][r][c][p][0] =
              default_coef_probs_4x4[b][r][c][p][0];
          vp9_get_model_distribution(default_coef_probs_4x4[b][r][c][p][1],
                                     pc->fc.coef_probs_4x4[b][r][c][p], b, r);
          pc->fc.coef_probs_8x8[b][r][c][p][0] =
              default_coef_probs_8x8[b][r][c][p][0];
          vp9_get_model_distribution(default_coef_probs_8x8[b][r][c][p][1],
                                     pc->fc.coef_probs_8x8[b][r][c][p], b, r);
          pc->fc.coef_probs_16x16[b][r][c][p][0] =
              default_coef_probs_16x16[b][r][c][p][0];
          vp9_get_model_distribution(default_coef_probs_16x16[b][r][c][p][1],
                                     pc->fc.coef_probs_16x16[b][r][c][p], b, r);
          pc->fc.coef_probs_32x32[b][r][c][p][0] =
              default_coef_probs_32x32[b][r][c][p][0];
          vp9_get_model_distribution(default_coef_probs_32x32[b][r][c][p][1],
                                     pc->fc.coef_probs_32x32[b][r][c][p], b, r);
        }
#else
  vpx_memcpy(pc->fc.coef_probs_4x4, default_coef_probs_4x4,
             sizeof(pc->fc.coef_probs_4x4));
  vpx_memcpy(pc->fc.coef_probs_8x8, default_coef_probs_8x8,
             sizeof(pc->fc.coef_probs_8x8));
  vpx_memcpy(pc->fc.coef_probs_16x16, default_coef_probs_16x16,
             sizeof(pc->fc.coef_probs_16x16));
  vpx_memcpy(pc->fc.coef_probs_32x32, default_coef_probs_32x32,
             sizeof(pc->fc.coef_probs_32x32));
#endif
}

#if CONFIG_MODELCOEFPROB
// This is a placeholder function that will enable the default coef probs to
// change for key frames based on the base_qindex. If base_qindex is large,
// we can expect probabilities of zeros to be bigger, and vice versa. The rest
// of the probabilities are derived from the nodel.
void vp9_adjust_default_coef_probs(VP9_COMMON *cm) {
  static const int factor_bits = 4;
  static const int factor_rnd = 8;   // (1 << (factor_bits - 1))
  int b, r, c, p;
  int factor = (1 << factor_bits);
  /*
  if (cm->base_qindex < 32)
    factor -= ((32 - cm->base_qindex) >> 4);
    */
  if (cm->base_qindex > 128)
    factor += ((cm->base_qindex - 128) >> 4);
  // printf(" Q %d factor %d\n", cm->base_qindex, factor);

  if (factor == 16)  // No change
    return;

  for (b = 0; b < BLOCK_TYPES; ++b)
    for (r = 0; r < REF_TYPES; ++r)
      for (c = 0; c < COEF_BANDS; ++c)
        for (p = 0; p < PREV_COEF_CONTEXTS; ++p) {
          int x;
          vp9_prob prob;
          x = (default_coef_probs_4x4[b][r][c][p][0] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          cm->fc.coef_probs_4x4[b][r][c][p][0] = prob;
          x = (default_coef_probs_4x4[b][r][c][p][1] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          vp9_get_model_distribution(
              prob, cm->fc.coef_probs_4x4[b][r][c][p], b, r);
          x = (default_coef_probs_8x8[b][r][c][p][0] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          cm->fc.coef_probs_8x8[b][r][c][p][0] = prob;
          x = (default_coef_probs_8x8[b][r][c][p][1] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          vp9_get_model_distribution(
              prob, cm->fc.coef_probs_8x8[b][r][c][p], b, r);
          x = (default_coef_probs_16x16[b][r][c][p][0] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          cm->fc.coef_probs_16x16[b][r][c][p][0] = prob;
          x = (default_coef_probs_16x16[b][r][c][p][1] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          vp9_get_model_distribution(
              prob, cm->fc.coef_probs_16x16[b][r][c][p], b, r);
          x = (default_coef_probs_32x32[b][r][c][p][0] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          cm->fc.coef_probs_32x32[b][r][c][p][0] = prob;
          x = (default_coef_probs_32x32[b][r][c][p][1] * factor + factor_rnd)
              >> factor_bits;
          prob = (x > 255 ? 255 : (x < 1 ? 1 : x));
          vp9_get_model_distribution(
              prob, cm->fc.coef_probs_32x32[b][r][c][p], b, r);
        }
}
#endif

void vp9_coef_tree_initialize() {
  init_bit_trees();
  vp9_tokens_from_tree(vp9_coef_encodings, vp9_coef_tree);
#if CONFIG_CODE_NONZEROCOUNT
  vp9_tokens_from_tree(vp9_nzc4x4_encodings, vp9_nzc4x4_tree);
  vp9_tokens_from_tree(vp9_nzc8x8_encodings, vp9_nzc8x8_tree);
  vp9_tokens_from_tree(vp9_nzc16x16_encodings, vp9_nzc16x16_tree);
  vp9_tokens_from_tree(vp9_nzc32x32_encodings, vp9_nzc32x32_tree);
#endif
}

#if CONFIG_CODE_NONZEROCOUNT

#define mb_in_cur_tile(cm, mb_row, mb_col)      \
    ((mb_col) >= (cm)->cur_tile_mb_col_start && \
     (mb_col) <= (cm)->cur_tile_mb_col_end   && \
     (mb_row) >= 0)

#define choose_nzc_context(nzc_exp, t2, t1)     \
    ((nzc_exp) >= (t2) ? 2 : (nzc_exp) >= (t1) ? 1 : 0)

#define NZC_T2_32X32    (16 << 6)
#define NZC_T1_32X32     (4 << 6)

#define NZC_T2_16X16    (12 << 6)
#define NZC_T1_16X16     (3 << 6)

#define NZC_T2_8X8       (8 << 6)
#define NZC_T1_8X8       (2 << 6)

#define NZC_T2_4X4       (4 << 6)
#define NZC_T1_4X4       (1 << 6)

// Transforms a mb16 block index to a sb64 block index
static inline int mb16_to_sb64_index(int mb_row, int mb_col, int block) {
  int r = (mb_row & 3);
  int c = (mb_col & 3);
  int b;
  if (block < 16) {  // Y
    int ib = block >> 2;
    int jb = block & 3;
    ib += r * 4;
    jb += c * 4;
    b = ib * 16 + jb;
    assert(b < 256);
    return b;
  } else {  // UV
    int base = block - (block & 3);
    int ib = (block - base) >> 1;
    int jb = (block - base) & 1;
    ib += r * 2;
    jb += c * 2;
    b = base * 16 + ib * 8 + jb;
    assert(b >= 256 && b < 384);
    return b;
  }
}

// Transforms a mb16 block index to a sb32 block index
static inline int mb16_to_sb32_index(int mb_row, int mb_col, int block) {
  int r = (mb_row & 1);
  int c = (mb_col & 1);
  int b;
  if (block < 16) {  // Y
    int ib = block >> 2;
    int jb = block & 3;
    ib += r * 4;
    jb += c * 4;
    b = ib * 8 + jb;
    assert(b < 64);
    return b;
  } else {  // UV
    int base = block - (block & 3);
    int ib = (block - base) >> 1;
    int jb = (block - base) & 1;
    ib += r * 2;
    jb += c * 2;
    b = base * 4 + ib * 4 + jb;
    assert(b >= 64 && b < 96);
    return b;
  }
}

static inline int block_to_txfm_index(int block, TX_SIZE tx_size, int s) {
  // s is the log of the number of 4x4 blocks in each row/col of larger block
  int b, ib, jb, nb;
  ib = block >> s;
  jb = block - (ib << s);
  ib >>= tx_size;
  jb >>= tx_size;
  nb = 1 << (s - tx_size);
  b = (ib * nb + jb) << (2 * tx_size);
  return b;
}

/* BEGIN - Helper functions to get the y nzcs */
static unsigned int get_nzc_4x4_y_sb64(MB_MODE_INFO *mi, int block) {
  int b;
  assert(block < 256);
  b = block_to_txfm_index(block, mi->txfm_size, 4);
  assert(b < 256);
  return mi->nzcs[b] << (6 - 2 * mi->txfm_size);
}

static unsigned int get_nzc_4x4_y_sb32(MB_MODE_INFO *mi, int block) {
  int b;
  assert(block < 64);
  b = block_to_txfm_index(block, mi->txfm_size, 3);
  assert(b < 64);
  return mi->nzcs[b] << (6 - 2 * mi->txfm_size);
}

static unsigned int get_nzc_4x4_y_mb16(MB_MODE_INFO *mi, int block) {
  int b;
  assert(block < 16);
  b = block_to_txfm_index(block, mi->txfm_size, 2);
  assert(b < 16);
  return mi->nzcs[b] << (6 - 2 * mi->txfm_size);
}
/* END - Helper functions to get the y nzcs */

/* Function to get y nzc where block index is in mb16 terms */
static unsigned int get_nzc_4x4_y(VP9_COMMON *cm, MODE_INFO *m,
                                  int mb_row, int mb_col, int block) {
  // NOTE: All values returned are at 64 times the true value at 4x4 scale
  MB_MODE_INFO *const mi = &m->mbmi;
  const int mis = cm->mode_info_stride;
  if (mi->mb_skip_coeff || !mb_in_cur_tile(cm, mb_row, mb_col))
    return 0;
  if (mi->sb_type == BLOCK_SIZE_SB64X64) {
    int r = mb_row & 3;
    int c = mb_col & 3;
    m -= c + r * mis;
    if (m->mbmi.mb_skip_coeff || !mb_in_cur_tile(cm, mb_row - r, mb_col - c))
      return 0;
    else
      return get_nzc_4x4_y_sb64(
          &m->mbmi, mb16_to_sb64_index(mb_row, mb_col, block));
  } else if (mi->sb_type == BLOCK_SIZE_SB32X32) {
    int r = mb_row & 1;
    int c = mb_col & 1;
    m -= c + r * mis;
    if (m->mbmi.mb_skip_coeff || !mb_in_cur_tile(cm, mb_row - r, mb_col - c))
      return 0;
    else
      return get_nzc_4x4_y_sb32(
          &m->mbmi, mb16_to_sb32_index(mb_row, mb_col, block));
  } else {
    if (m->mbmi.mb_skip_coeff || !mb_in_cur_tile(cm, mb_row, mb_col))
      return 0;
    return get_nzc_4x4_y_mb16(mi, block);
  }
}

/* BEGIN - Helper functions to get the uv nzcs */
static unsigned int get_nzc_4x4_uv_sb64(MB_MODE_INFO *mi, int block) {
  int b;
  int base, uvtxfm_size;
  assert(block >= 256 && block < 384);
  uvtxfm_size = mi->txfm_size;
  base = 256 + (block & 64);
  block -= base;
  b = base + block_to_txfm_index(block, uvtxfm_size, 3);
  assert(b >= 256 && b < 384);
  return mi->nzcs[b] << (6 - 2 * uvtxfm_size);
}

static unsigned int get_nzc_4x4_uv_sb32(MB_MODE_INFO *mi, int block) {
  int b;
  int base, uvtxfm_size;
  assert(block >= 64 && block < 96);
  if (mi->txfm_size == TX_32X32)
    uvtxfm_size = TX_16X16;
  else
    uvtxfm_size = mi->txfm_size;
  base = 64 + (block & 16);
  block -= base;
  b = base + block_to_txfm_index(block, uvtxfm_size, 2);
  assert(b >= 64 && b < 96);
  return mi->nzcs[b] << (6 - 2 * uvtxfm_size);
}

static unsigned int get_nzc_4x4_uv_mb16(MB_MODE_INFO *mi, int block) {
  int b;
  int base, uvtxfm_size;
  assert(block >= 16 && block < 24);
  if (mi->txfm_size == TX_8X8 &&
      (mi->mode == SPLITMV || mi->mode == I8X8_PRED))
    uvtxfm_size = TX_4X4;
  else if (mi->txfm_size == TX_16X16)
    uvtxfm_size = TX_8X8;
  else
    uvtxfm_size = mi->txfm_size;
  base = 16 + (block & 4);
  block -= base;
  b = base + block_to_txfm_index(block, uvtxfm_size, 1);
  assert(b >= 16 && b < 24);
  return mi->nzcs[b] << (6 - 2 * uvtxfm_size);
}
/* END - Helper functions to get the uv nzcs */

/* Function to get uv nzc where block index is in mb16 terms */
static unsigned int get_nzc_4x4_uv(VP9_COMMON *cm, MODE_INFO *m,
                                   int mb_row, int mb_col, int block) {
  // NOTE: All values returned are at 64 times the true value at 4x4 scale
  MB_MODE_INFO *const mi = &m->mbmi;
  const int mis = cm->mode_info_stride;
  if (mi->mb_skip_coeff || !mb_in_cur_tile(cm, mb_row, mb_col))
    return 0;
  if (mi->sb_type == BLOCK_SIZE_SB64X64) {
    int r = mb_row & 3;
    int c = mb_col & 3;
    m -= c + r * mis;
    if (m->mbmi.mb_skip_coeff || !mb_in_cur_tile(cm, mb_row - r, mb_col - c))
      return 0;
    else
      return get_nzc_4x4_uv_sb64(
          &m->mbmi, mb16_to_sb64_index(mb_row, mb_col, block));
  } else if (mi->sb_type == BLOCK_SIZE_SB32X32) {
    int r = mb_row & 1;
    int c = mb_col & 1;
    m -= c + r * mis;
    if (m->mbmi.mb_skip_coeff || !mb_in_cur_tile(cm, mb_row - r, mb_col - c))
      return 0;
    else
    return get_nzc_4x4_uv_sb32(
        &m->mbmi, mb16_to_sb32_index(mb_row, mb_col, block));
  } else {
    return get_nzc_4x4_uv_mb16(mi, block);
  }
}

int vp9_get_nzc_context_y_sb64(VP9_COMMON *cm, MODE_INFO *cur,
                               int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  assert(block < 256);
  switch (txfm_size) {
    case TX_32X32:
      assert((block & 63) == 0);
      if (block < 128) {
        int o = (block >> 6) * 2;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 12) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 13) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 14) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 15) +
            get_nzc_4x4_y(cm, cur - mis + o + 1,
                          mb_row - 1, mb_col + o + 1, 12) +
            get_nzc_4x4_y(cm, cur - mis + o + 1,
                          mb_row - 1, mb_col + o + 1, 13) +
            get_nzc_4x4_y(cm, cur - mis + o + 1,
                          mb_row - 1, mb_col + o + 1, 14) +
            get_nzc_4x4_y(cm, cur - mis + o + 1,
                          mb_row - 1, mb_col + o + 1, 15);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 128] << 3;
      }
      if ((block & 127) == 0) {
        int o = (block >> 7) * 2;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 3) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 7) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 11) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 15) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis + mis,
                          mb_row + o + 1, mb_col - 1, 3) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis + mis,
                          mb_row + o + 1, mb_col - 1, 7) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis + mis,
                          mb_row + o + 1, mb_col - 1, 11) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis + mis,
                          mb_row + o + 1, mb_col - 1, 15);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 64] << 3;
      }
      nzc_exp <<= 2;
      // Note nzc_exp is 64 times the average value expected at 32x32 scale
      return choose_nzc_context(nzc_exp, NZC_T2_32X32, NZC_T1_32X32);
      break;

    case TX_16X16:
      assert((block & 15) == 0);
      if (block < 64) {
        int o = block >> 4;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 12) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 13) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 14) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 15);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 64] << 4;
      }
      if ((block & 63) == 0) {
        int o = block >> 6;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 3) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 7) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 11) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 15);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 16] << 4;
      }
      nzc_exp <<= 1;
      // Note nzc_exp is 64 times the average value expected at 16x16 scale
      return choose_nzc_context(nzc_exp, NZC_T2_16X16, NZC_T1_16X16);
      break;

    case TX_8X8:
      assert((block & 3) == 0);
      if (block < 32) {
        int o = block >> 3;
        int p = ((block >> 2) & 1) ? 14 : 12;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, p) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, p + 1);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 32] << 5;
      }
      if ((block & 31) == 0) {
        int o = block >> 6;
        int p = ((block >> 5) & 1) ? 11 : 3;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, p) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, p + 4);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 4] << 5;
      }
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);
      break;

    case TX_4X4:
      if (block < 16) {
        int o = block >> 2;
        int p = block & 3;
        nzc_exp = get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o,
                                12 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 16] << 6);
      }
      if ((block & 15) == 0) {
        int o = block >> 6;
        int p = (block >> 4) & 3;
        nzc_exp += get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                                 3 + 4 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);
      break;

    default:
      return 0;
  }
}

int vp9_get_nzc_context_y_sb32(VP9_COMMON *cm, MODE_INFO *cur,
                               int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  assert(block < 64);
  switch (txfm_size) {
    case TX_32X32:
      assert(block == 0);
      nzc_exp =
          (get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 12) +
           get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 13) +
           get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 14) +
           get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 15) +
           get_nzc_4x4_y(cm, cur - mis + 1, mb_row - 1, mb_col + 1, 12) +
           get_nzc_4x4_y(cm, cur - mis + 1, mb_row - 1, mb_col + 1, 13) +
           get_nzc_4x4_y(cm, cur - mis + 1, mb_row - 1, mb_col + 1, 14) +
           get_nzc_4x4_y(cm, cur - mis + 1, mb_row - 1, mb_col + 1, 15) +
           get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 3) +
           get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 7) +
           get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 11) +
           get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 15) +
           get_nzc_4x4_y(cm, cur - 1 + mis, mb_row + 1, mb_col - 1, 3) +
           get_nzc_4x4_y(cm, cur - 1 + mis, mb_row + 1, mb_col - 1, 7) +
           get_nzc_4x4_y(cm, cur - 1 + mis, mb_row + 1, mb_col - 1, 11) +
           get_nzc_4x4_y(cm, cur - 1 + mis, mb_row + 1, mb_col - 1, 15)) << 2;
      // Note nzc_exp is 64 times the average value expected at 32x32 scale
      return choose_nzc_context(nzc_exp, NZC_T2_32X32, NZC_T1_32X32);
      break;

    case TX_16X16:
      assert((block & 15) == 0);
      if (block < 32) {
        int o = (block >> 4) & 1;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 12) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 13) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 14) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, 15);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 32] << 4;
      }
      if ((block & 31) == 0) {
        int o = block >> 5;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 3) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 7) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 11) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, 15);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 16] << 4;
      }
      nzc_exp <<= 1;
      // Note nzc_exp is 64 times the average value expected at 16x16 scale
      return choose_nzc_context(nzc_exp, NZC_T2_16X16, NZC_T1_16X16);
      break;

    case TX_8X8:
      assert((block & 3) == 0);
      if (block < 16) {
        int o = block >> 3;
        int p = ((block >> 2) & 1) ? 14 : 12;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, p) +
            get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o, p + 1);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 16] << 5;
      }
      if ((block & 15) == 0) {
        int o = block >> 5;
        int p = ((block >> 4) & 1) ? 11 : 3;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, p) +
            get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1, p + 4);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 4] << 5;
      }
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);
      break;

    case TX_4X4:
      if (block < 8) {
        int o = block >> 2;
        int p = block & 3;
        nzc_exp = get_nzc_4x4_y(cm, cur - mis + o, mb_row - 1, mb_col + o,
                                12 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 8] << 6);
      }
      if ((block & 7) == 0) {
        int o = block >> 5;
        int p = (block >> 3) & 3;
        nzc_exp += get_nzc_4x4_y(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                                 3 + 4 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);
      break;

    default:
      return 0;
      break;
  }
}

int vp9_get_nzc_context_y_mb16(VP9_COMMON *cm, MODE_INFO *cur,
                               int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  assert(block < 16);
  switch (txfm_size) {
    case TX_16X16:
      assert(block == 0);
      nzc_exp =
          get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 12) +
          get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 13) +
          get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 14) +
          get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, 15) +
          get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 3) +
          get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 7) +
          get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 11) +
          get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, 15);
      nzc_exp <<= 1;
      // Note nzc_exp is 64 times the average value expected at 16x16 scale
      return choose_nzc_context(nzc_exp, NZC_T2_16X16, NZC_T1_16X16);

    case TX_8X8:
      assert((block & 3) == 0);
      if (block < 8) {
        int p = ((block >> 2) & 1) ? 14 : 12;
        nzc_exp =
            get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, p) +
            get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col, p + 1);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 8] << 5;
      }
      if ((block & 7) == 0) {
        int p = ((block >> 3) & 1) ? 11 : 3;
        nzc_exp +=
            get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, p) +
            get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1, p + 4);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 4] << 5;
      }
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);

    case TX_4X4:
      if (block < 4) {
        int p = block & 3;
        nzc_exp = get_nzc_4x4_y(cm, cur - mis, mb_row - 1, mb_col,
                                12 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 4] << 6);
      }
      if ((block & 3) == 0) {
        int p = (block >> 2) & 3;
        nzc_exp += get_nzc_4x4_y(cm, cur - 1, mb_row, mb_col - 1,
                                 3 + 4 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);

    default:
      return 0;
      break;
  }
}

int vp9_get_nzc_context_uv_sb64(VP9_COMMON *cm, MODE_INFO *cur,
                                int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  const int base = block - (block & 63);
  const int boff = (block & 63);
  const int base_mb16 = base >> 4;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  TX_SIZE txfm_size_uv;

  assert(block >= 256 && block < 384);
  txfm_size_uv = txfm_size;

  switch (txfm_size_uv) {
    case TX_32X32:
      assert(block == 256 || block == 320);
      nzc_exp =
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - mis + 1, mb_row - 1, mb_col + 1,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis + 1, mb_row - 1, mb_col + 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - mis + 2, mb_row - 1, mb_col + 2,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis + 2, mb_row - 1, mb_col + 2,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - mis + 3, mb_row - 1, mb_col + 3,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis + 3, mb_row - 1, mb_col + 3,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1, mb_row, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1, mb_row, mb_col - 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row + 1, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row + 1, mb_col - 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1 + 2 * mis, mb_row + 2, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1 + 2 * mis, mb_row + 2, mb_col - 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1 + 3 * mis, mb_row + 3, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1 + 3 * mis, mb_row + 3, mb_col - 1,
                         base_mb16 + 3);
      nzc_exp <<= 2;
      // Note nzc_exp is 64 times the average value expected at 32x32 scale
      return choose_nzc_context(nzc_exp, NZC_T2_32X32, NZC_T1_32X32);

    case TX_16X16:
      // uv txfm_size 16x16
      assert((block & 15) == 0);
      if (boff < 32) {
        int o = (boff >> 4) & 1;
        nzc_exp =
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 2) +
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 3) +
            get_nzc_4x4_uv(cm, cur - mis + o + 1, mb_row - 1, mb_col + o + 1,
                           base_mb16 + 2) +
            get_nzc_4x4_uv(cm, cur - mis + o + 1, mb_row - 1, mb_col + o + 1,
                           base_mb16 + 3);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 32] << 4;
      }
      if ((boff & 31) == 0) {
        int o = boff >> 5;
        nzc_exp +=
            get_nzc_4x4_uv(cm, cur - 1 + o * mis,
                           mb_row + o, mb_col - 1, base_mb16 + 1) +
            get_nzc_4x4_uv(cm, cur - 1 + o * mis,
                           mb_row + o, mb_col - 1, base_mb16 + 3) +
            get_nzc_4x4_uv(cm, cur - 1 + o * mis + mis,
                           mb_row + o + 1, mb_col - 1, base_mb16 + 1) +
            get_nzc_4x4_uv(cm, cur - 1 + o * mis + mis,
                           mb_row + o + 1, mb_col - 1, base_mb16 + 3);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 16] << 4;
      }
      nzc_exp <<= 1;
      // Note nzc_exp is 64 times the average value expected at 16x16 scale
      return choose_nzc_context(nzc_exp, NZC_T2_16X16, NZC_T1_16X16);

    case TX_8X8:
      assert((block & 3) == 0);
      if (boff < 16) {
        int o = boff >> 2;
        nzc_exp =
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 2) +
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 3);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 16] << 5;
      }
      if ((boff & 15) == 0) {
        int o = boff >> 4;
        nzc_exp +=
            get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                           base_mb16 + 1) +
            get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                           base_mb16 + 3);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 4] << 5;
      }
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);

    case TX_4X4:
      if (boff < 8) {
        int o = boff >> 1;
        int p = boff & 1;
        nzc_exp = get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                                 base_mb16 + 2 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 8] << 6);
      }
      if ((boff & 7) == 0) {
        int o = boff >> 4;
        int p = (boff >> 3) & 1;
        nzc_exp += get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                                  base_mb16 + 1 + 2 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);

    default:
      return 0;
  }
}

int vp9_get_nzc_context_uv_sb32(VP9_COMMON *cm, MODE_INFO *cur,
                                int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  const int base = block - (block & 15);
  const int boff = (block & 15);
  const int base_mb16 = base >> 2;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  TX_SIZE txfm_size_uv;

  assert(block >= 64 && block < 96);
  if (txfm_size == TX_32X32)
    txfm_size_uv = TX_16X16;
  else
    txfm_size_uv = txfm_size;

  switch (txfm_size_uv) {
    case TX_16X16:
      // uv txfm_size 16x16
      assert(block == 64 || block == 80);
      nzc_exp =
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - mis + 1, mb_row - 1, mb_col + 1,
                         base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis + 1, mb_row - 1, mb_col + 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row, mb_col - 1,
                         base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row + 1, mb_col - 1,
                         base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1 + mis, mb_row + 1, mb_col - 1,
                         base_mb16 + 3);
      nzc_exp <<= 1;
      // Note nzc_exp is 64 times the average value expected at 16x16 scale
      return choose_nzc_context(nzc_exp, NZC_T2_16X16, NZC_T1_16X16);
      break;

    case TX_8X8:
      assert((block & 3) == 0);
      if (boff < 8) {
        int o = boff >> 2;
        nzc_exp =
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 2) +
            get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                           base_mb16 + 3);
      } else {
        nzc_exp = cur->mbmi.nzcs[block - 8] << 5;
      }
      if ((boff & 7) == 0) {
        int o = boff >> 3;
        nzc_exp +=
            get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                           base_mb16 + 1) +
            get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                           base_mb16 + 3);
      } else {
        nzc_exp += cur->mbmi.nzcs[block - 4] << 5;
      }
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);

    case TX_4X4:
      if (boff < 4) {
        int o = boff >> 1;
        int p = boff & 1;
        nzc_exp = get_nzc_4x4_uv(cm, cur - mis + o, mb_row - 1, mb_col + o,
                                 base_mb16 + 2 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 4] << 6);
      }
      if ((boff & 3) == 0) {
        int o = boff >> 3;
        int p = (boff >> 2) & 1;
        nzc_exp += get_nzc_4x4_uv(cm, cur - 1 + o * mis, mb_row + o, mb_col - 1,
                                  base_mb16 + 1 + 2 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);

    default:
      return 0;
  }
}

int vp9_get_nzc_context_uv_mb16(VP9_COMMON *cm, MODE_INFO *cur,
                                int mb_row, int mb_col, int block) {
  // returns an index in [0, MAX_NZC_CONTEXTS - 1] to reflect how busy
  // neighboring blocks are
  int mis = cm->mode_info_stride;
  int nzc_exp = 0;
  const int base = block - (block & 3);
  const int boff = (block & 3);
  const int base_mb16 = base;
  TX_SIZE txfm_size = cur->mbmi.txfm_size;
  TX_SIZE txfm_size_uv;

  assert(block >= 16 && block < 24);
  if (txfm_size == TX_16X16)
    txfm_size_uv = TX_8X8;
  else if (txfm_size == TX_8X8 &&
           (cur->mbmi.mode == I8X8_PRED || cur->mbmi.mode == SPLITMV))
    txfm_size_uv = TX_4X4;
  else
    txfm_size_uv = txfm_size;

  switch (txfm_size_uv) {
    case TX_8X8:
      assert((block & 3) == 0);
      nzc_exp =
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col, base_mb16 + 2) +
          get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col, base_mb16 + 3) +
          get_nzc_4x4_uv(cm, cur - 1, mb_row, mb_col - 1, base_mb16 + 1) +
          get_nzc_4x4_uv(cm, cur - 1, mb_row, mb_col - 1, base_mb16 + 3);
      // Note nzc_exp is 64 times the average value expected at 8x8 scale
      return choose_nzc_context(nzc_exp, NZC_T2_8X8, NZC_T1_8X8);

    case TX_4X4:
      if (boff < 2) {
        int p = boff & 1;
        nzc_exp = get_nzc_4x4_uv(cm, cur - mis, mb_row - 1, mb_col,
                                 base_mb16 + 2 + p);
      } else {
        nzc_exp = (cur->mbmi.nzcs[block - 2] << 6);
      }
      if ((boff & 1) == 0) {
        int p = (boff >> 1) & 1;
        nzc_exp += get_nzc_4x4_uv(cm, cur - 1, mb_row, mb_col - 1,
                                  base_mb16 + 1 + 2 * p);
      } else {
        nzc_exp += (cur->mbmi.nzcs[block - 1] << 6);
      }
      nzc_exp >>= 1;
      // Note nzc_exp is 64 times the average value expected at 4x4 scale
      return choose_nzc_context(nzc_exp, NZC_T2_4X4, NZC_T1_4X4);

    default:
      return 0;
  }
}

int vp9_get_nzc_context(VP9_COMMON *cm, MACROBLOCKD *xd, int block) {
  if (xd->mode_info_context->mbmi.sb_type == BLOCK_SIZE_SB64X64) {
    assert(block < 384);
    if (block < 256)
      return vp9_get_nzc_context_y_sb64(cm, xd->mode_info_context,
                                        get_mb_row(xd), get_mb_col(xd), block);
    else
      return vp9_get_nzc_context_uv_sb64(cm, xd->mode_info_context,
                                         get_mb_row(xd), get_mb_col(xd), block);
  } else if (xd->mode_info_context->mbmi.sb_type == BLOCK_SIZE_SB32X32) {
    assert(block < 96);
    if (block < 64)
      return vp9_get_nzc_context_y_sb32(cm, xd->mode_info_context,
                                        get_mb_row(xd), get_mb_col(xd), block);
    else
      return vp9_get_nzc_context_uv_sb32(cm, xd->mode_info_context,
                                         get_mb_row(xd), get_mb_col(xd), block);
  } else {
    assert(block < 64);
    if (block < 16)
      return vp9_get_nzc_context_y_mb16(cm, xd->mode_info_context,
                                        get_mb_row(xd), get_mb_col(xd), block);
    else
      return vp9_get_nzc_context_uv_mb16(cm, xd->mode_info_context,
                                         get_mb_row(xd), get_mb_col(xd), block);
  }
}

static void update_nzc(VP9_COMMON *cm,
                       uint16_t nzc,
                       int nzc_context,
                       TX_SIZE tx_size,
                       int ref,
                       int type) {
  int e, c;
  c = codenzc(nzc);
  if (tx_size == TX_32X32)
    cm->fc.nzc_counts_32x32[nzc_context][ref][type][c]++;
  else if (tx_size == TX_16X16)
    cm->fc.nzc_counts_16x16[nzc_context][ref][type][c]++;
  else if (tx_size == TX_8X8)
    cm->fc.nzc_counts_8x8[nzc_context][ref][type][c]++;
  else if (tx_size == TX_4X4)
    cm->fc.nzc_counts_4x4[nzc_context][ref][type][c]++;
  else
    assert(0);

  if ((e = vp9_extranzcbits[c])) {
    int x = nzc - vp9_basenzcvalue[c];
    while (e--) {
      int b = (x >> e) & 1;
      cm->fc.nzc_pcat_counts[nzc_context][c - NZC_TOKENS_NOEXTRA][e][b]++;
    }
  }
}

static void update_nzcs_sb64(VP9_COMMON *cm,
                             MACROBLOCKD *xd,
                             int mb_row,
                             int mb_col) {
  MODE_INFO *m = xd->mode_info_context;
  MB_MODE_INFO *const mi = &m->mbmi;
  int j, nzc_context;
  const int ref = m->mbmi.ref_frame != INTRA_FRAME;

  assert(mb_col == get_mb_col(xd));
  assert(mb_row == get_mb_row(xd));

  if (mi->mb_skip_coeff)
    return;

  switch (mi->txfm_size) {
    case TX_32X32:
      for (j = 0; j < 256; j += 64) {
        nzc_context = vp9_get_nzc_context_y_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_32X32, ref, 0);
      }
      for (j = 256; j < 384; j += 64) {
        nzc_context = vp9_get_nzc_context_uv_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_32X32, ref, 1);
      }
      break;

    case TX_16X16:
      for (j = 0; j < 256; j += 16) {
        nzc_context = vp9_get_nzc_context_y_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 0);
      }
      for (j = 256; j < 384; j += 16) {
        nzc_context = vp9_get_nzc_context_uv_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 1);
      }
      break;

    case TX_8X8:
      for (j = 0; j < 256; j += 4) {
        nzc_context = vp9_get_nzc_context_y_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 0);
      }
      for (j = 256; j < 384; j += 4) {
        nzc_context = vp9_get_nzc_context_uv_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 1);
      }
      break;

    case TX_4X4:
      for (j = 0; j < 256; ++j) {
        nzc_context = vp9_get_nzc_context_y_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 0);
      }
      for (j = 256; j < 384; ++j) {
        nzc_context = vp9_get_nzc_context_uv_sb64(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 1);
      }
      break;

    default:
      break;
  }
}

static void update_nzcs_sb32(VP9_COMMON *cm,
                            MACROBLOCKD *xd,
                            int mb_row,
                            int mb_col) {
  MODE_INFO *m = xd->mode_info_context;
  MB_MODE_INFO *const mi = &m->mbmi;
  int j, nzc_context;
  const int ref = m->mbmi.ref_frame != INTRA_FRAME;

  assert(mb_col == get_mb_col(xd));
  assert(mb_row == get_mb_row(xd));

  if (mi->mb_skip_coeff)
    return;

  switch (mi->txfm_size) {
    case TX_32X32:
      for (j = 0; j < 64; j += 64) {
        nzc_context = vp9_get_nzc_context_y_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_32X32, ref, 0);
      }
      for (j = 64; j < 96; j += 16) {
        nzc_context = vp9_get_nzc_context_uv_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 1);
      }
      break;

    case TX_16X16:
      for (j = 0; j < 64; j += 16) {
        nzc_context = vp9_get_nzc_context_y_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 0);
      }
      for (j = 64; j < 96; j += 16) {
        nzc_context = vp9_get_nzc_context_uv_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 1);
      }
      break;

    case TX_8X8:
      for (j = 0; j < 64; j += 4) {
        nzc_context = vp9_get_nzc_context_y_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 0);
      }
      for (j = 64; j < 96; j += 4) {
        nzc_context = vp9_get_nzc_context_uv_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 1);
      }
      break;

    case TX_4X4:
      for (j = 0; j < 64; ++j) {
        nzc_context = vp9_get_nzc_context_y_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 0);
      }
      for (j = 64; j < 96; ++j) {
        nzc_context = vp9_get_nzc_context_uv_sb32(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 1);
      }
      break;

    default:
      break;
  }
}

static void update_nzcs_mb16(VP9_COMMON *cm,
                             MACROBLOCKD *xd,
                             int mb_row,
                             int mb_col) {
  MODE_INFO *m = xd->mode_info_context;
  MB_MODE_INFO *const mi = &m->mbmi;
  int j, nzc_context;
  const int ref = m->mbmi.ref_frame != INTRA_FRAME;

  assert(mb_col == get_mb_col(xd));
  assert(mb_row == get_mb_row(xd));

  if (mi->mb_skip_coeff)
    return;

  switch (mi->txfm_size) {
    case TX_16X16:
      for (j = 0; j < 16; j += 16) {
        nzc_context = vp9_get_nzc_context_y_mb16(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_16X16, ref, 0);
      }
      for (j = 16; j < 24; j += 4) {
        nzc_context = vp9_get_nzc_context_uv_mb16(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 1);
      }
      break;

    case TX_8X8:
      for (j = 0; j < 16; j += 4) {
        nzc_context = vp9_get_nzc_context_y_mb16(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 0);
      }
      if (mi->mode == I8X8_PRED || mi->mode == SPLITMV) {
        for (j = 16; j < 24; ++j) {
          nzc_context = vp9_get_nzc_context_uv_mb16(cm, m, mb_row, mb_col, j);
          update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 1);
        }
      } else {
        for (j = 16; j < 24; j += 4) {
          nzc_context = vp9_get_nzc_context_uv_mb16(cm, m, mb_row, mb_col, j);
          update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_8X8, ref, 1);
        }
      }
      break;

    case TX_4X4:
      for (j = 0; j < 16; ++j) {
        nzc_context = vp9_get_nzc_context_y_mb16(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 0);
      }
      for (j = 16; j < 24; ++j) {
        nzc_context = vp9_get_nzc_context_uv_mb16(cm, m, mb_row, mb_col, j);
        update_nzc(cm, m->mbmi.nzcs[j], nzc_context, TX_4X4, ref, 1);
      }
      break;

    default:
      break;
  }
}

void vp9_update_nzc_counts(VP9_COMMON *cm,
                           MACROBLOCKD *xd,
                           int mb_row,
                           int mb_col) {
  if (xd->mode_info_context->mbmi.sb_type == BLOCK_SIZE_SB64X64)
    update_nzcs_sb64(cm, xd, mb_row, mb_col);
  else if (xd->mode_info_context->mbmi.sb_type == BLOCK_SIZE_SB32X32)
    update_nzcs_sb32(cm, xd, mb_row, mb_col);
  else
    update_nzcs_mb16(cm, xd, mb_row, mb_col);
}
#endif  // CONFIG_CODE_NONZEROCOUNT

// #define COEF_COUNT_TESTING

#define COEF_COUNT_SAT 24
#define COEF_MAX_UPDATE_FACTOR 112
#define COEF_COUNT_SAT_KEY 24
#define COEF_MAX_UPDATE_FACTOR_KEY 112
#define COEF_COUNT_SAT_AFTER_KEY 24
#define COEF_MAX_UPDATE_FACTOR_AFTER_KEY 128

static void adapt_coef_probs(vp9_coeff_probs *dst_coef_probs,
                             vp9_coeff_probs *pre_coef_probs,
                             int block_types, vp9_coeff_count *coef_counts,
                             int count_sat, int update_factor) {
  int t, i, j, k, l, count;
  unsigned int branch_ct[ENTROPY_NODES][2];
  vp9_prob coef_probs[ENTROPY_NODES];
  int factor;
#if CONFIG_MODELCOEFPROB && MODEL_BASED_ADAPT
  int entropy_nodes_adapt = UNCONSTRAINED_ADAPT_NODES;
#else
  int entropy_nodes_adapt = ENTROPY_NODES;
#endif

  for (i = 0; i < block_types; ++i)
    for (j = 0; j < REF_TYPES; ++j)
      for (k = 0; k < COEF_BANDS; ++k)
        for (l = 0; l < PREV_COEF_CONTEXTS; ++l) {
          if (l >= 3 && k == 0)
            continue;
          vp9_tree_probs_from_distribution(vp9_coef_tree,
                                           coef_probs, branch_ct,
                                           coef_counts[i][j][k][l], 0);
          for (t = 0; t < entropy_nodes_adapt; ++t) {
            count = branch_ct[t][0] + branch_ct[t][1];
            count = count > count_sat ? count_sat : count;
            factor = (update_factor * count / count_sat);
            dst_coef_probs[i][j][k][l][t] =
                weighted_prob(pre_coef_probs[i][j][k][l][t],
                              coef_probs[t], factor);
#if CONFIG_MODELCOEFPROB && MODEL_BASED_ADAPT
            if (t == 1)
              vp9_get_model_distribution(dst_coef_probs[i][j][k][l][1],
                                         dst_coef_probs[i][j][k][l], i, j);
#endif
          }
        }
}

void vp9_adapt_coef_probs(VP9_COMMON *cm) {
  int count_sat;
  int update_factor; /* denominator 256 */

  // printf("Frame type: %d\n", cm->frame_type);
  if (cm->frame_type == KEY_FRAME) {
    update_factor = COEF_MAX_UPDATE_FACTOR_KEY;
    count_sat = COEF_COUNT_SAT_KEY;
  } else if (cm->last_frame_type == KEY_FRAME) {
    update_factor = COEF_MAX_UPDATE_FACTOR_AFTER_KEY;  /* adapt quickly */
    count_sat = COEF_COUNT_SAT_AFTER_KEY;
  } else {
    update_factor = COEF_MAX_UPDATE_FACTOR;
    count_sat = COEF_COUNT_SAT;
  }

  adapt_coef_probs(cm->fc.coef_probs_4x4, cm->fc.pre_coef_probs_4x4,
                   BLOCK_TYPES, cm->fc.coef_counts_4x4,
                   count_sat, update_factor);
  adapt_coef_probs(cm->fc.coef_probs_8x8, cm->fc.pre_coef_probs_8x8,
                   BLOCK_TYPES, cm->fc.coef_counts_8x8,
                   count_sat, update_factor);
  adapt_coef_probs(cm->fc.coef_probs_16x16, cm->fc.pre_coef_probs_16x16,
                   BLOCK_TYPES, cm->fc.coef_counts_16x16,
                   count_sat, update_factor);
  adapt_coef_probs(cm->fc.coef_probs_32x32, cm->fc.pre_coef_probs_32x32,
                   BLOCK_TYPES, cm->fc.coef_counts_32x32,
                   count_sat, update_factor);
}

#if CONFIG_CODE_NONZEROCOUNT
static void adapt_nzc_probs(VP9_COMMON *cm,
                            int block_size,
                            int count_sat,
                            int update_factor) {
  int c, r, b, n;
  int count, factor;
  unsigned int nzc_branch_ct[NZC32X32_NODES][2];
  vp9_prob nzc_probs[NZC32X32_NODES];
  int tokens, nodes;
  const vp9_tree_index *nzc_tree;
  vp9_prob *dst_nzc_probs;
  vp9_prob *pre_nzc_probs;
  unsigned int *nzc_counts;

  if (block_size == 32) {
    tokens = NZC32X32_TOKENS;
    nzc_tree = vp9_nzc32x32_tree;
    dst_nzc_probs = cm->fc.nzc_probs_32x32[0][0][0];
    pre_nzc_probs = cm->fc.pre_nzc_probs_32x32[0][0][0];
    nzc_counts = cm->fc.nzc_counts_32x32[0][0][0];
  } else if (block_size == 16) {
    tokens = NZC16X16_TOKENS;
    nzc_tree = vp9_nzc16x16_tree;
    dst_nzc_probs = cm->fc.nzc_probs_16x16[0][0][0];
    pre_nzc_probs = cm->fc.pre_nzc_probs_16x16[0][0][0];
    nzc_counts = cm->fc.nzc_counts_16x16[0][0][0];
  } else if (block_size == 8) {
    tokens = NZC8X8_TOKENS;
    nzc_tree = vp9_nzc8x8_tree;
    dst_nzc_probs = cm->fc.nzc_probs_8x8[0][0][0];
    pre_nzc_probs = cm->fc.pre_nzc_probs_8x8[0][0][0];
    nzc_counts = cm->fc.nzc_counts_8x8[0][0][0];
  } else {
    nzc_tree = vp9_nzc4x4_tree;
    tokens = NZC4X4_TOKENS;
    dst_nzc_probs = cm->fc.nzc_probs_4x4[0][0][0];
    pre_nzc_probs = cm->fc.pre_nzc_probs_4x4[0][0][0];
    nzc_counts = cm->fc.nzc_counts_4x4[0][0][0];
  }
  nodes = tokens - 1;
  for (c = 0; c < MAX_NZC_CONTEXTS; ++c)
    for (r = 0; r < REF_TYPES; ++r)
      for (b = 0; b < BLOCK_TYPES; ++b) {
        int offset = c * REF_TYPES * BLOCK_TYPES + r * BLOCK_TYPES + b;
        int offset_nodes = offset * nodes;
        int offset_tokens = offset * tokens;
        vp9_tree_probs_from_distribution(nzc_tree,
                                         nzc_probs, nzc_branch_ct,
                                         nzc_counts + offset_tokens, 0);
        for (n = 0; n < nodes; ++n) {
          count = nzc_branch_ct[n][0] + nzc_branch_ct[n][1];
          count = count > count_sat ? count_sat : count;
          factor = (update_factor * count / count_sat);
          dst_nzc_probs[offset_nodes + n] =
              weighted_prob(pre_nzc_probs[offset_nodes + n],
                            nzc_probs[n], factor);
        }
      }
}

static void adapt_nzc_pcat(VP9_COMMON *cm, int count_sat, int update_factor) {
  int c, t;
  int count, factor;
  for (c = 0; c < MAX_NZC_CONTEXTS; ++c) {
    for (t = 0; t < NZC_TOKENS_EXTRA; ++t) {
      int bits = vp9_extranzcbits[t + NZC_TOKENS_NOEXTRA];
      int b;
      for (b = 0; b < bits; ++b) {
        vp9_prob prob = get_binary_prob(cm->fc.nzc_pcat_counts[c][t][b][0],
                                        cm->fc.nzc_pcat_counts[c][t][b][1]);
        count = cm->fc.nzc_pcat_counts[c][t][b][0] +
                cm->fc.nzc_pcat_counts[c][t][b][1];
        count = count > count_sat ? count_sat : count;
        factor = (update_factor * count / count_sat);
        cm->fc.nzc_pcat_probs[c][t][b] = weighted_prob(
            cm->fc.pre_nzc_pcat_probs[c][t][b], prob, factor);
      }
    }
  }
}

// #define NZC_COUNT_TESTING
void vp9_adapt_nzc_probs(VP9_COMMON *cm) {
  int count_sat;
  int update_factor; /* denominator 256 */
#ifdef NZC_COUNT_TESTING
  int c, r, b, t;
  printf("\n");
  for (c = 0; c < MAX_NZC_CONTEXTS; ++c)
    for (r = 0; r < REF_TYPES; ++r) {
      for (b = 0; b < BLOCK_TYPES; ++b) {
        printf("    {");
        for (t = 0; t < NZC4X4_TOKENS; ++t) {
          printf(" %d,", cm->fc.nzc_counts_4x4[c][r][b][t]);
        }
        printf("}\n");
      }
      printf("\n");
    }
#endif

  if (cm->frame_type == KEY_FRAME) {
    update_factor = COEF_MAX_UPDATE_FACTOR_KEY;
    count_sat = COEF_COUNT_SAT_KEY;
  } else if (cm->last_frame_type == KEY_FRAME) {
    update_factor = COEF_MAX_UPDATE_FACTOR_AFTER_KEY;  /* adapt quickly */
    count_sat = COEF_COUNT_SAT_AFTER_KEY;
  } else {
    update_factor = COEF_MAX_UPDATE_FACTOR;
    count_sat = COEF_COUNT_SAT;
  }

  adapt_nzc_probs(cm, 4, count_sat, update_factor);
  adapt_nzc_probs(cm, 8, count_sat, update_factor);
  adapt_nzc_probs(cm, 16, count_sat, update_factor);
  adapt_nzc_probs(cm, 32, count_sat, update_factor);
  adapt_nzc_pcat(cm, count_sat, update_factor);
}
#endif  // CONFIG_CODE_NONZEROCOUNT
