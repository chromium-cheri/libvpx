{
  "comments": [
    {
      "key": {
        "uuid": "AAAAQH//5a0\u003d",
        "filename": "vp8/encoder/pickinter.c",
        "patchSetId": 1
      },
      "lineNbr": 640,
      "author": {
        "id": 1000884
      },
      "writtenOn": "2012-10-08T21:07:02Z",
      "side": 1,
      "message": "Should we do\nif (!parent_ref_flag)\ncpi-\u003emr_low_res_mv_avail \u003d 0;  \ninstead?\n\nif ( cpi-\u003emr_low_res_mv_avail \u003d\u003d 0) then, motion search is done independently without using any lower level info.\n\nparent_ref_frame \u003d 0 may be used if we add more rules (for example, if (parent_ref_frame \u003d\u003d 0) child_ref_frame \u003d 0;)\n\nAlso, you don\u0027t need to modify ref_frame_map.",
      "revId": "30d8ba541ede1d79b3d1d72f66ff05fcab6b5f92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAQH//5Yk\u003d",
        "filename": "vp8/encoder/pickinter.c",
        "patchSetId": 1
      },
      "lineNbr": 640,
      "author": {
        "id": 1000856
      },
      "writtenOn": "2012-10-08T21:33:11Z",
      "side": 1,
      "message": "Setting cpi-\u003emr_low_res_mv_avail \u003d 0 would shut off the lower level for the whole frame, instead of just this MB. Seems like we can still use the lower res search for other MBs as long as the reference is valid.\n\nI think that we can get away from using parent_ref_frame, but I\u0027d rather do it as part of a clean up commit. ie, we could create a local validity flag, like:\n\n  int parent_ref_valid \u003d cpi-\u003eoxcf.mr_encoder_id \u0026\u0026 cpi-\u003emr_low_res_mv_avail;\n\nThat would clean up a bunch of code, and give a convenient thing to invalidate without changing the parent_ref_frame if we ever support forcing intra on child frames. I think it\u0027d touch more than just fixing this bug though. Can I do it as a second commit?\n\nChanging to use ref_frame_map was intentional. Changing the frame search order is the purpose of that extra lookup. This encode may be running at a different speed than its parent, and for instance if the parent chooses the second reference, and this one penalizes or shuts off the second reference, then the pick modes loop won\u0027t run under the old code. My change runs the pick loop using the parent ref frame as the highest priority reference, so it gets the same level of searching regardless of which frame it actually is. There was a small quality improvement with this, iirc.",
      "parentUuid": "AAAAQH//5a0\u003d",
      "revId": "30d8ba541ede1d79b3d1d72f66ff05fcab6b5f92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAQH//5Xo\u003d",
        "filename": "vp8/encoder/pickinter.c",
        "patchSetId": 1
      },
      "lineNbr": 640,
      "author": {
        "id": 1000884
      },
      "writtenOn": "2012-10-08T21:53:22Z",
      "side": 1,
      "message": "Sounds good.",
      "parentUuid": "AAAAQH//5Yk\u003d",
      "revId": "30d8ba541ede1d79b3d1d72f66ff05fcab6b5f92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAQH//5XM\u003d",
        "filename": "vp8/encoder/pickinter.c",
        "patchSetId": 1
      },
      "lineNbr": 658,
      "author": {
        "id": 1000884
      },
      "writtenOn": "2012-10-08T21:53:22Z",
      "side": 1,
      "message": "If dissim is very small, we only search on parent_ref_frame. So, ref_frame_map[0] \u003d INTRA_FRAME can be removed ?",
      "revId": "30d8ba541ede1d79b3d1d72f66ff05fcab6b5f92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "AAAAQH//5T0\u003d",
        "filename": "vp8/encoder/pickinter.c",
        "patchSetId": 1
      },
      "lineNbr": 658,
      "author": {
        "id": 1000856
      },
      "writtenOn": "2012-10-08T22:40:31Z",
      "side": 1,
      "message": "ref_frame_map[0] can\u0027t be inter, but you can disable the intra search by setting ref_frame_map[0] \u003d -1. I tried this on one clip (bond) and it hurt quality (approx -0.04dB PSNR, +1.5% filesize). Didn\u0027t make much of a difference on Andrei. The speed impact was ~0.2% on Andrei, negligible on Bond.\n\nI\u0027m ok with turning it off, but let\u0027s do it as a separate patch. This one has been tested to resolve a webrtc bug that we can\u0027t reproduce, and since they\u0027re looking to do a release today I\u0027d like to give them a commit they can pull that matches what they tested functionally. We can experiment with this some more after.",
      "parentUuid": "AAAAQH//5XM\u003d",
      "revId": "30d8ba541ede1d79b3d1d72f66ff05fcab6b5f92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}